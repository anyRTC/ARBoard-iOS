/*!
  * ar-whiteboard v1.0.7
  * (c) 2021 anyRTC WhiteBoard SDK
  * @license MIT
  */
var ArWhiteBoard=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},e(t,i)};function i(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}var o=function(){return o=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},o.apply(this,arguments)};function n(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{h(o.next(t))}catch(t){r(t)}}function a(t){try{h(o.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((o=o.apply(t,e||[])).next())}))}function r(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var o,n,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return s}function h(t,e,i){if(i||2===arguments.length)for(var o,n=0,r=e.length;n<r;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}var l,c,d,p,u,_,f,v={SDK_VERSION:"1.0.7",GATEWAY_ADDRESS:"https://wbgw.agrtc.cn",GATEWAY_ADDRESS1:"https://wbgw.agrtc.cn",GATEWAY_ADDRESS_SSL:!0,GATEWAY_CONNECT_TIMEOUT:2e3,REPORT_DOMAIN:"",REPORT_BACKUP_DOMAIN:"",LOADING_ICON:'\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; display: block;" width="140px" height="140px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n      <defs>\n        <filter id="filter" x="-100%" y="-100%" width="300%" height="300%" color-interpolation-filters="sRGB">\n          <feGaussianBlur in="SourceGraphic" stdDeviation="2.4000000000000004"></feGaussianBlur>\n          <feComponentTransfer result="cutoff">\n            <feFuncA type="table" tableValues="0 0 0 0 0 0 1 1 1 1 1"></feFuncA>\n          </feComponentTransfer>\n        </filter>\n      </defs>\n      <g filter="url(#filter)"><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#220b09">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="4s" repeatCount="indefinite" begin="-0.25s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="4s" repeatCount="indefinite" begin="0s"></animateTransform>\n      </g>\n      </g><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#d34c31">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="2s" repeatCount="indefinite" begin="-0.20833333333333334s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="2s" repeatCount="indefinite" begin="-0.041666666666666664s"></animateTransform>\n      </g>\n      </g><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#e88432">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="1.3333333333333333s" repeatCount="indefinite" begin="-0.16666666666666666s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="1.3333333333333333s" repeatCount="indefinite" begin="-0.08333333333333333s"></animateTransform>\n      </g>\n      </g><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#ff312d">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="1s" repeatCount="indefinite" begin="-0.125s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="1s" repeatCount="indefinite" begin="-0.125s"></animateTransform>\n      </g>\n      </g><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#f5c037">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="0.8s" repeatCount="indefinite" begin="-0.08333333333333333s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="0.8s" repeatCount="indefinite" begin="-0.16666666666666666s"></animateTransform>\n      </g>\n      </g><g transform="translate(50 50)">\n      <g>\n        <circle cx="17" cy="0" r="5" fill="#e89788">\n          <animate attributeName="r" keyTimes="0;0.5;1" values="3.5999999999999996;8.399999999999999;3.5999999999999996" dur="0.6666666666666666s" repeatCount="indefinite" begin="-0.041666666666666664s"></animate>\n        </circle>\n        <animateTransform attributeName="transform" type="rotate" keyTimes="0;1" values="0;360" dur="0.6666666666666666s" repeatCount="indefinite" begin="-0.20833333333333334s"></animateTransform>\n      </g>\n      </g></g>\n    </svg>\n  ',BOARD_BACKGROUND_COLOR:"#FFFFFF",BOARD_SELECT_STYLE:{lineDash:[5,5],lineWidth:1,strokeStyle:"#ababab"},SHAPE_SELECT_STYLE:{lineDash:[8,8],strokeStyle:"#ababab",lineWidth:1},TEXT_INPUT_ELEMENT_OPTIONS:{kind:"textarea",props:{"has-origin-text":"0",spellCheck:!1},style:{":focus-border":"1px solid red","z-index":"9",position:"absolute",display:"inline-block","backface-visibility":"hidden",margin:"0px",padding:"0px",outline:"none",resize:"none",background:"transparent",overflow:"hidden","white-space":"pre-wrap","word-break":"break-all","font-family":"customFontFamily , sans-serif, serif, monospace","font-style":"normal","font-weight":"normal",top:"0px",left:"0px","min-width":"12px","min-height":"12px",width:"12px",height:"12px",border:"1px solid transparent","box-sizing":"content-box",color:"#333333","font-size":"12px","line-height":"12px"}},CONTROL_DIR_STYLE:{position:"absolute",width:"8px",height:"8px",background:"red","background-clip":"padding-box",border:"2px solid transparent","box-sizing":"content-box"}},E={MISSING_PARAMETER:"MISSING_PARAMETER",DEVELOPER_INVALID:"DEVELOPER_INVALID",UID_BANNED:"UID_BANNED",IP_BANNED:"IP_BANNED",CHANNEL_BANNED:"CHANNEL_BANNED",APPID_INVALID:"APPID_INVALID",SERVER_NOT_OPEN:"SERVER_NOT_OPEN",TOKEN_EXPIRED:"TOKEN_EXPIRED",TOKEN_INVALID:"TOKEN_INVALID",INVALID_PARAMS:"INVALID_PARAMS",INVALID_OPERATION:"INVALID_OPERATION",CAN_NOT_GET_GATEWAY_SERVER:"CAN_NOT_GET_GATEWAY_SERVER",GATEWAY_SERVER_ERROR:"GATEWAY_SERVER_ERROR",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED"},y={NETWORK_TIMEOUT:"NETWORK_TIMEOUT",NETWORK_RESPONSE_ERROR:"NETWORK_RESPONSE_ERROR",NETWORK_ERROR:"NETWORK_ERROR",WS_ABORT:"WS_ABORT",WS_DISCONNECT:"WS_DISCONNECT",WS_ERR:"WS_ERR",KEEP_A_LIVE_TIMEOUT:"KEEP_A_LIVE_TIMEOUT"};!function(t){t.ARROW="Arrow",t.CIRCLE="Circle",t.LASER_POINTER="LaserPointer",t.ELLIPSE="Ellipse",t.RECT="Rect",t.LINE="Line",t.FREE_DRAW="FreeDraw",t.TEXT="Text"}(l||(l={})),function(t){t[t.CONNECT=2e5]="CONNECT",t[t.INIT=3e5]="INIT",t[t.CHAN_DATA=300001]="CHAN_DATA",t[t.ADD_FILE=300002]="ADD_FILE",t[t.DELETE_FILE=300003]="DELETE_FILE",t[t.FILE_LIST=300004]="FILE_LIST",t[t.BRUSH_DATA=300005]="BRUSH_DATA",t[t.CUR_BOARD_DATA=300006]="CUR_BOARD_DATA",t[t.CACHE_BOARD_DATA=300007]="CACHE_BOARD_DATA",t[t.BOARD_LIST=31e4]="BOARD_LIST",t[t.CHAN_BOARD_LIST=310001]="CHAN_BOARD_LIST",t[t.BOARD_DATA=310002]="BOARD_DATA",t[t.ADD_BOARD=310003]="ADD_BOARD",t[t.SWITCH_BOARD=310004]="SWITCH_BOARD",t[t.DELETE_BOARD=310005]="DELETE_BOARD",t[t.SCALE_BOARD=310006]="SCALE_BOARD",t[t.BOARD_RATIO=310007]="BOARD_RATIO",t[t.RESET_BOARD=310008]="RESET_BOARD",t[t.CLEAR_BOARD=310009]="CLEAR_BOARD",t[t.UPDATE_BACKGROUND=310010]="UPDATE_BACKGROUND",t[t.UPDATE_BACKGROUND_IMAGE=310011]="UPDATE_BACKGROUND_IMAGE",t[t.UPDATE_BACKGROUND_H5=310012]="UPDATE_BACKGROUND_H5",t[t.ADD_SHAPE=32e4]="ADD_SHAPE",t[t.MOVE_SHAPE=320001]="MOVE_SHAPE",t[t.DELETE_SHAPE=320002]="DELETE_SHAPE",t[t.PROCESS_SHAPE=320003]="PROCESS_SHAPE",t[t.INVALID_PARAMS=4e5]="INVALID_PARAMS",t[t.INTERNAL_ERROR=5e5]="INTERNAL_ERROR",t[t.KEEP_A_LIVE=6e5]="KEEP_A_LIVE"}(c||(c={})),function(t){t.ERROR="board-error",t.WARNING="board-warning",t.CONNECTION_STATE_CHANGE="connection-state-change",t.DATA_SYNC_COMPLETED="data-sync-completed",t.ADD_BOARD="add-board",t.DELETE_BOARD="delete-board",t.GOTO_BOARD="goto-board",t.CLEAR_BOARD="clear-board",t.RESET_BOARD="reset-board",t.SCALE_BOARD="board-scale-change",t.RATIO_BOARD="board-ratio-change",t.CAN_UNDO_STATUS_CHANGE="board-can-undo-status",t.CAN_REDO_STATUS_CHANGE="board-can-redo-status",t.BOARD_BACKGROUND_COLOR_CHANGE="board-background-color-change"}(d||(d={})),function(t){t[t.DISCONNECTED=0]="DISCONNECTED",t[t.CONNECTING=1]="CONNECTING",t[t.RECONNECTING=2]="RECONNECTING",t[t.CONNECTED=3]="CONNECTED",t[t.DISCONNECTING=4]="DISCONNECTING"}(p||(p={})),function(t){t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.NETWORK_ERROR="NETWORK_ERROR",t.KEEP_A_LIVE_TIMEOUT="KEEP_A_LIVE_TIMEOUT",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER"}(u||(u={})),t.BoardToolType=void 0,(_=t.BoardToolType||(t.BoardToolType={}))[_.NONE=0]="NONE",_[_.SELECT=1]="SELECT",_[_.FREE_DRAW=2]="FREE_DRAW",_[_.ERASER=3]="ERASER",_[_.LASER_POINTER=4]="LASER_POINTER",_[_.LINE=5]="LINE",_[_.ARROW=6]="ARROW",_[_.RECT=7]="RECT",_[_.ELLIPSE=8]="ELLIPSE",_[_.TEXT=9]="TEXT",function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED",t[t.FOCUSED=2]="FOCUSED"}(f||(f={}));var g,S=function(){function t(t,e,i,o,n){void 0===o&&(o=[0,0]),this.id="",this.rectWithStrokePadding=10,this._props={},this._position=[0,0],this._rect={x:0,y:0,width:0,height:0},this._rectWithStroke={x:0,y:0,width:0,height:0},this.style={lineWidth:1,opacity:1,lineDash:[],fillStyle:"",strokeStyle:"#000000"},this.selectState=f.DEFAULT,this.group=0,this.id=t,this.type=e,n&&(this.style=n),this.props=i,this.position=o}return Object.defineProperty(t.prototype,"props",{get:function(){return this._props},set:function(t){this._props=t,this._rect=this._calculateShapeRectBounding(),this._rectWithStroke=this._calculateShapeRectWithStrokeBounding()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._rect=this._calculateShapeRectBounding(),this._rectWithStroke=this._calculateShapeRectWithStrokeBounding()},enumerable:!1,configurable:!0}),t.prototype.getBoundingRect=function(){return this._rectWithStroke},t.prototype.rectContain=function(t,e){var i=this._rectWithStroke,o=i.x,n=i.y,r=i.width,s=i.height;return t>=o&&t<=o+r&&e>=n&&e<=n+s},t.prototype.isPointInPath=function(t,e){return!1},t.prototype.buildPath=function(t,e){var i=o(o({},this.style),null==e?void 0:e.style),n=i.strokeStyle,r=i.lineWidth,s=i.lineDash,a=i.fillStyle;a&&(t.fillStyle=a),n&&(t.strokeStyle=n),r&&(t.lineWidth=r),s&&t.setLineDash(s)},t.prototype.buildElement=function(t){},t.prototype.attr=function(t,e){"props"===t?this.props=o(o({},this.props),e):"position"===t?this.position=h([],a(e)):"style"===t&&(this.style=o(o({},this.style),e))},t.prototype._calculateShapeRectBounding=function(){return{x:0,y:0,width:0,height:0}},t.prototype._calculateShapeRectWithStrokeBounding=function(){return{x:0,y:0,width:0,height:0}},t}(),T=function(t){function e(e,i){return t.call(this,e,l.ARROW,i.props||{points:[]},i.position||[0,0],i.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props.points,e=this.position;if(4===(null==t?void 0:t.length)){var i=this.style.lineWidth,o=i/2,n=0,r=0,s=0,a=0;t.forEach((function(t,i){0===i?(n=s=t[0]+e[0],r=a=t[1]+e[1]):(n=t[0]+e[0]<n?t[0]+e[0]:n,r=t[1]+e[1]<r?t[1]+e[1]:r,s=t[0]+e[0]>s?t[0]+e[0]:s,a=t[1]+e[1]>a?t[1]+e[1]:a)}));var h=Math.floor(Math.abs(s-n)),l=Math.floor(Math.abs(a-r));return{x:n-o,y:r-o,width:h+i,height:l+i}}return{x:0,y:0,width:0,height:0}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props.points,e=this.position;if(4===(null==t?void 0:t.length)){var i=this.style.lineWidth,o=i/2,n=0,r=0,s=0,a=0;t.forEach((function(t,i){0===i?(n=s=t[0]+e[0],r=a=t[1]+e[1]):(n=t[0]+e[0]<n?t[0]+e[0]:n,r=t[1]+e[1]<r?t[1]+e[1]:r,s=t[0]+e[0]>s?t[0]+e[0]:s,a=t[1]+e[1]>a?t[1]+e[1]:a)}));var h=Math.floor(Math.abs(s-n)),l=Math.floor(Math.abs(a-r));return{x:n-this.rectWithStrokePadding/2-o,y:r-this.rectWithStrokePadding/2-o,width:h+this.rectWithStrokePadding+i,height:l+this.rectWithStrokePadding+i}}return{x:0,y:0,width:0,height:0}},e.prototype.isPointInPath=function(t,e){var i=this._props.points,o=this.position;if(4===(null==i?void 0:i.length)){var n=this.style.lineWidth/2,r=0,s=0,a=0,h=0;return i.forEach((function(t,e){0===e?(r=a=t[0]+o[0],s=h=t[1]+o[1]):(r=(t[0]+o[0]<r?t[0]+o[0]:r)-n,s=(t[1]+o[1]<s?t[1]+o[1]:s)-n,a=(t[0]+o[0]>a?t[0]+o[0]:a)+n,h=(t[1]+o[1]>h?t[1]+o[1]:h)+n)})),t>=r&&t<=a&&e>=s&&e<=h}return!1},e.prototype.buildPath=function(e,i){e.save(),t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props),r=(null==i?void 0:i.position)||this.position;if(n&&n.points&&n.points.length>=4){var s=n.points;e.beginPath(),e.moveTo(s[0][0]+r[0],s[0][1]+r[1]),e.lineTo(s[1][0]+r[0],s[1][1]+r[1]),e.moveTo(s[2][0]+r[0],s[2][1]+r[1]),e.lineTo(s[1][0]+r[0],s[1][1]+r[1]),e.lineTo(s[3][0]+r[0],s[3][1]+r[1]),e.stroke()}e.restore()},e}(S),C=function(t){function e(e,i){return t.call(this,e,l.CIRCLE,i.props||{x1:0,y1:0,x2:0,y2:0},i.position||[0,0],i.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x1,i=t.x2,o=t.y1,n=t.y2,r=this.style.lineWidth,s=r/2;return{x:(e<i?e:i)-s,y:(o<n?o:n)-s,width:Math.abs(e-i)+r,height:Math.abs(o-n)+r}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x1,i=t.x2,o=t.y1,n=t.y2,r=this.style.lineWidth,s=r/2,a=(o<n?o:n)-s;return{x:(e<i?e:i)-s-this.rectWithStrokePadding/2,y:a-this.rectWithStrokePadding/2,width:Math.abs(e-i)+this.rectWithStrokePadding+r,height:Math.abs(o-n)+this.rectWithStrokePadding+r}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.x1,n=i.x2,r=i.y1,s=i.y2,a=this.style.lineWidth/2;return t>=(o<n?o:n)-a&&t<=(o<n?n:o)+a&&e>=(r<s?r:s)-a&&e<=(r<s?s:r)+a},e.prototype.buildPath=function(e,i){t.prototype.buildPath.call(this,e,i);var o=i.props,n=i.style;if(n&&n.fillStyle||this.style&&this.style.fillStyle,o){var r=o.x1,s=o.x2,a=o.y1,h=o.y2,l=0,c=0,d=0,p=0;r<s?(l=r,c=a,d=s,p=h):(l=s,c=h,d=r,p=a);var u=Math.abs(d-l),_=Math.abs(p-c),f=u<_?_/2:u/2,v=l+f,E=c+f;e.beginPath(),e.arc(v,E,f,0,360),e.stroke()}},e}(S),m=function(t){function e(e,i){return t.call(this,e,l.ELLIPSE,i.props||{cx:0,cy:0,xr:0,yr:0},i.position||[0,0],i.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.cx,i=t.cy,o=t.xr,n=t.yr,r=this.position,s=this.style.lineWidth/2;return{x:Math.floor(e-o)+r[0]-s,y:Math.floor(i-n)+r[1]-s,width:2*o+s,height:2*n+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.cx,i=t.cy,o=t.xr,n=t.yr,r=this.position,s=this.style.lineWidth,a=s/2,h=Math.floor(e-o)+r[0]-a,l=Math.floor(i-n)+r[1]-a;return{x:h-this.rectWithStrokePadding/2,y:l-this.rectWithStrokePadding/2,width:2*o+this.rectWithStrokePadding+s,height:2*n+this.rectWithStrokePadding+s}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.cx,n=i.cy,r=i.xr,s=i.yr,a=this.position,h=this.style.lineWidth/2,l=Math.floor(o-r)+a[0]-h,c=Math.floor(n-s)+a[1]-h,d=Math.floor(o+r)+a[0]+h,p=Math.floor(n+s)+a[1]+h;return t>=l&&t<=d&&e>=c&&e<=p},e.prototype.buildPath=function(e,i){e.save(),t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props),r=(null==i?void 0:i.position)||this.position;if(n){var s=n.cx,a=n.cy,h=n.xr,l=n.yr;e.beginPath(),e.ellipse(s+r[0],a+r[1],h,l,0,0,360),e.stroke()}e.restore()},e}(S),b=function(t){function e(e,i){return t.call(this,e,l.FREE_DRAW,i.props||{points:[]},i.position||[0,0],i.style||{lineWidth:1,strokeStyle:"#000000"})||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this.props.points,e=this.position;if(t&&t.length>1){var i=0,o=0,n=0,r=0;t.forEach((function(t,s){0===s?(i=n=t[0]+e[0],o=r=t[1]+e[1]):(i=t[0]+e[0]<i?t[0]+e[0]:i,o=t[1]+e[1]<o?t[1]+e[1]:o,n=t[0]+e[0]>n?t[0]+e[0]:n,r=t[1]+e[1]>r?t[1]+e[1]:r)}));var s=this.style.lineWidth,a=s/2,h=Math.floor(Math.abs(n-i))+s,l=Math.floor(Math.abs(r-o))+s;return{x:i-a,y:o-a,width:h,height:l}}return{x:0,y:0,width:0,height:0}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this.props.points,e=this.position;if(t&&t.length>1){var i=0,o=0,n=0,r=0;t.forEach((function(t,s){0===s?(i=n=t[0]+e[0],o=r=t[1]+e[1]):(i=t[0]+e[0]<i?t[0]+e[0]:i,o=t[1]+e[1]<o?t[1]+e[1]:o,n=t[0]+e[0]>n?t[0]+e[0]:n,r=t[1]+e[1]>r?t[1]+e[1]:r)}));var s=this.style.lineWidth,a=s/2,h=Math.floor(Math.abs(n-i))+s,l=Math.floor(Math.abs(r-o))+s;return{x:i-a-this.rectWithStrokePadding/2,y:o-a-this.rectWithStrokePadding/2,width:h+this.rectWithStrokePadding,height:l+this.rectWithStrokePadding}}return{x:0,y:0,width:0,height:0}},e.prototype.isPointInPath=function(t,e){var i=this.props.points,o=this.position;if(i&&i.length>1){var n=this.style.lineWidth/2,r=0,s=0,a=0,h=0;return i.forEach((function(t,e){0===e?(r=a=t[0]+o[0],s=h=t[1]+o[1]):(r=(t[0]+o[0]<r?t[0]+o[0]:r)-n,s=(t[1]+o[1]<s?t[1]+o[1]:s)-n,a=(t[0]+o[0]>a?t[0]+o[0]:a)+n,h=(t[1]+o[1]>h?t[1]+o[1]:h)+n)})),t>=r&&t<=a&&e>=s&&e<=h}return!1},e.prototype.buildPath=function(e,i){e.save(),t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props),r=(null==i?void 0:i.position)||this.position;if(n){var s=n.points,a=r[0],h=r[1];if(!s)return;if(s.length>2){e.lineCap="round",e.lineJoin="round",e.beginPath();for(var l=0;l<s.length-1;l++)if(0===l)e.moveTo(s[0][0]+a,s[0][1]+h);else if(l===s.length-2)e.lineTo(s[l-1][0]+a,s[l-1][1]+h),e.stroke();else{if(l===s.length-1)return;var c=s[l+1],d=(c[0]+s[l+2][0])/2+a,p=(c[1]+s[l+2][1])/2+h;e.quadraticCurveTo(c[0]+a,c[1]+h,d,p)}}}e.restore()},e}(S),A=function(t,e){void 0===e&&(e={});var i=t.kind,n=t.key,r=t.props,s=t.style,a=t.children,h=document.createElement(i);return n&&(e[n]=h),r&&Object.keys(r).forEach((function(t){h.setAttribute(t,r[t])})),s&&Object.keys(s).forEach((function(t){h.style.setProperty(t,s[t])})),a&&a.forEach((function(t){var i=A(t,e);t.key&&(e[t.key]=i.el),h.append(i.el)})),o(o({},e),{el:h})},I=function(t){function e(e,i){var o=t.call(this,e,l.LASER_POINTER,i.props||{cx:0,cy:0,r:0},i.position||[0,0],i.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this,n=A({kind:"div",props:{"data-uid":e,class:"board-laser_item"},style:{position:"absolute",left:"0",top:"0","z-index":"40","will-change":"transform","pointer-events":"none",transform:"translate("+(o.props.cx+o.position[0]||0)+"px, "+(o.props.cy+o.position[1]||0)+"px) scale(1.0)"},children:[{kind:"img",props:{src:"data:image/svg+xml,%3csvg width='36px' height='36px' viewBox='0 0 36 36' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3elaser-pointer%3c/title%3e %3cdefs%3e %3cradialGradient cx='50%25' cy='50%25' fx='50%25' fy='50%25' r='50%25' id='radialGradient-1'%3e %3cstop stop-color='%23FF001C' offset='0%25'%3e%3c/stop%3e %3cstop stop-color='%23FF001C' stop-opacity='0' offset='100%25'%3e%3c/stop%3e %3c/radialGradient%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-1544.000000%2c -264.000000)'%3e %3cg transform='translate(1544.000000%2c 264.000000)'%3e %3ccircle fill='url(%23radialGradient-1)' cx='18' cy='18' r='12'%3e%3c/circle%3e %3ccircle stroke='white' fill='%23FF001C' cx='18' cy='18' r='2.5'%3e%3c/circle%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/svg%3e"},style:{display:"block","pointer-events":"none",position:"absolute",transform:"translate(-50%, -50%)"}}]}).el;return o.el=n,o}return i(e,t),e.prototype._getTextBounding=function(){var t,e;return{width:(null===(t=this.el)||void 0===t?void 0:t.offsetWidth)||0,height:(null===(e=this.el)||void 0===e?void 0:e.offsetHeight)||0}},e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,i=t.y,o=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+o[0],y:i+o[1],width:r,height:s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,i=t.y,o=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+o[0]-this.rectWithStrokePadding/2,y:i+o[1]-this.rectWithStrokePadding/2,width:r+this.rectWithStrokePadding,height:s+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.cx,n=i.cy,r=this.position,s=this._getTextBounding(),a=s.width,h=s.height,l=o+r[0],c=n+r[1];return t>=l&&t<=l+a&&e>=c&&e<=c+h},e.prototype.buildPath=function(t,e){},e.prototype.addPosition=function(t,e){this.position[0]+=t,this.position[1]+=e,this.setPosition(this.position[0],this.position[1])},e.prototype.setPosition=function(t,e){this.el&&(this.position=[t,e],this.el.style.transform="translate("+(this.props.cx+t)+"px, "+(this.props.cy+e)+"px) scale(1.0)")},e.prototype.buildElement=function(t){var e;t instanceof HTMLElement?t.appendChild(this.el):"string"==typeof t&&(null===(e=document.querySelector("#"+t))||void 0===e||e.appendChild(this.el))},e.prototype.dispose=function(){var t;null===(t=this.el)||void 0===t||t.remove()},e}(S),D=function(t){function e(e,i){return t.call(this,e,l.LINE,i.props||{x:0,y:0,x1:0,y1:0},i.position||[0,0],i.style||{fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"})||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,i=t.y,o=t.x1,n=t.y1,r=this.position,s=this.style.lineWidth,a=s/2,h=(i<n?i:n)-a;return{x:(e<o?e:o)-a+r[0],y:h+r[1],width:Math.floor(Math.abs(o-e))+s,height:Math.floor(Math.abs(n-i))+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,i=t.y,o=t.x1,n=t.y1,r=this.position,s=this.style.lineWidth,a=s/2,h=(i<n?i:n)-a;return{x:(e<o?e:o)-a+r[0]-this.rectWithStrokePadding/2,y:h+r[1]-this.rectWithStrokePadding/2,width:Math.floor(Math.abs(o-e))+this.rectWithStrokePadding+s,height:Math.floor(Math.abs(n-i))+this.rectWithStrokePadding+s}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.x,n=i.y,r=i.x1,s=i.y1,a=this.position,h=this.style.lineWidth/2,l=(o<r?o:r)+a[0]-h,c=(n<s?n:s)+a[1]-h,d=(o<r?r:o)+a[0]+h,p=(n<s?s:n)+a[1]+h;return t>=l&&t<=d&&e>=c&&e<=p},e.prototype.buildPath=function(e,i){e.save(),t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props),r=(null==i?void 0:i.position)||this.position;if(n){var s=n.x,a=n.y,h=n.x1,l=n.y1;e.beginPath(),e.moveTo(s+r[0],a+r[1]),e.lineTo(h+r[0],l+r[1]),e.stroke()}e.restore()},e}(S),N=function(t){function e(e,i){return t.call(this,e,l.RECT,o({x1:0,y1:0,x2:0,y2:0},i.props),i.position||[0,0],o({fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000"},i.style))||this}return i(e,t),e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x1,i=t.y1,o=t.x2,n=t.y2,r=this.position,s=this.style.lineWidth,a=s/2,h=e<o?e:o-a,l=i<n?i:n-a,c=Math.abs(o-e)+s,d=Math.abs(n-i)+s;return{x:h+r[0],y:l+r[1],width:c+s,height:d+s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x1,i=t.y1,o=t.x2,n=t.y2,r=this.position,s=this.style.lineWidth,a=s/2,h=(e<o?e:o)-a,l=(i<n?i:n)-a,c=Math.abs(o-e)+s,d=Math.abs(n-i)+s;return{x:h+r[0]-this.rectWithStrokePadding/2,y:l+r[1]-this.rectWithStrokePadding/2,width:c+this.rectWithStrokePadding,height:d+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.x1,n=i.y1,r=i.x2,s=i.y2,a=this.position,h=this.style.lineWidth/2,l=(o<r?o:r)+a[0]-h,c=(n<s?n:s)+a[1]-h,d=(o<r?r:o)+a[0]+h,p=(n<s?s:n)+a[1]+h;return t>=l&&t<=d&&e>=c&&e<=p},e.prototype.buildPath=function(e,i){e.save(),t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props),r=(null==i?void 0:i.position)||this.position;if(n){var s=n.x1,a=n.y1,h=n.x2,l=n.y2,c=(s<h?s:h)+r[0],d=(a<l?a:l)+r[1];e.beginPath(),e.rect(c,d,Math.abs(h-s),Math.abs(l-a)),e.stroke()}e.restore()},e}(S),R=document.createElement("canvas").getContext("2d"),B=function(t,e,i){var o=t.replace(/\n|\r/gi,"<br />").split("<br />"),n=[],r=0;return o.forEach((function(t,o){var s=x(t,e,i),l=s.width,c=s.list;r<l&&(r=l),n.push.apply(n,h([],a(c)))})),{width:r,height:n.length*e.lineHeight,list:n}},x=function(t,e,i){var o=0,n=[],r=e.fontSize,s=e.fontFamily,a=e.lineHeight;if(R.font=r+"px/"+a+"px "+s,R.measureText(t).width<=i){var h=Math.ceil(R.measureText(t).width);n.push({text:t,width:h}),o=h>r?h:r}else for(var l="",c=0,d=0;d<t.length;d++){l+=t[d];var p=R.measureText(l).width;if(p===i){h=Math.ceil(R.measureText(t.substring(c,d+1)).width);n.push({text:t.substring(c,d+1),width:h}),o<h&&(o=h),c=d+1,l=""}else if(p>i){h=Math.ceil(R.measureText(t.substring(c,d)).width);n.push({text:t.substring(c,d),width:h}),o<h&&(o=h),c=d;var u=t.substring(c),_=Math.ceil(R.measureText(u).width);if(_<=i){n.push({text:u,width:_}),o<_&&(o=_);break}l=t[d]}else if(d===t.length-1){h=Math.ceil(R.measureText(t.substring(c)).width);n.push({text:t.substring(c),width:h}),o<h&&(o=h)}}return{list:n,width:o}},O=function(t){function e(e,i){return t.call(this,e,l.TEXT,o({text:"",x:0,y:0,width:0,height:0,maxWidth:0,maxHeight:0,fontSize:12,lineHeight:12},i.props),i.position||[0,0],o({fillStyle:"transparent",lineWidth:1,strokeStyle:"#000000",textFill:"#000000",textStroke:"#000000",fontFamily:"customFontFamily, sans-serif, serif, monospace"},i.style))||this}return i(e,t),e.prototype._getTextBounding=function(){var t=A({kind:"canvas"}).el.getContext("2d"),e=this._props,i=e.text,o=e.fontSize,n=e.lineHeight,r=this.style;r.lineWidth;var s=r.textFill,a=r.textStroke,h=r.fontFamily;if(a&&(t.strokeStyle=a),s&&(t.fillStyle=s),o&&(t.font=o+"px "+h),i){var l=B(i,{fontSize:o,lineHeight:n,fontFamily:h},this.props.maxWidth),c=l.width,d=l.height;return l.list,{width:c,height:d}}return{width:0,height:o||0}},e.prototype._calculateShapeRectBounding=function(){var t=this._props,e=t.x,i=t.y,o=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+o[0],y:i+o[1],width:r,height:s}},e.prototype._calculateShapeRectWithStrokeBounding=function(){var t=this._props,e=t.x,i=t.y,o=this.position,n=this._getTextBounding(),r=n.width,s=n.height;return{x:e+o[0]-this.rectWithStrokePadding/2,y:i+o[1]-this.rectWithStrokePadding/2,width:r+this.rectWithStrokePadding,height:s+this.rectWithStrokePadding}},e.prototype.isPointInPath=function(t,e){var i=this._props,o=i.x,n=i.y,r=this.position,s=this._getTextBounding(),a=s.width,h=s.height,l=o+r[0],c=n+r[1];return t>=l&&t<=l+a&&e>=c&&e<=c+h},e.prototype.setFontSize=function(t){this.style.fontSize=t,this._calculateShapeRectBounding(),this._calculateShapeRectWithStrokeBounding()},e.prototype.buildPath=function(e,i){t.prototype.buildPath.call(this,e,i);var n=o(o({},this.props),null==i?void 0:i.props);if((null==i?void 0:i.position)||this.position,n&&n.text){e.save();var r=n.text,s=n.fontSize,a=n.lineHeight,h=n.maxWidth,l=this._rect,c=l.x,d=l.y,p=l.width,u=l.height,_=o(o({},this.style),null==i?void 0:i.style),f=_.textFill,v=_.textStroke,E=_.fontFamily;v&&(e.fillStyle=v),f&&(e.fillStyle=f),s&&(e.font=s+"px "+E),e.beginPath(),e.rect(c,d,p,u);var y=B(r,{fontSize:s,lineHeight:a,fontFamily:E},h);y.width,y.height,y.list.forEach((function(t,i){e.fillText(t.text,c,d+(i+1)*a)})),e.restore()}},e}(S),w=function(t,e){var i="YYYY-MM-DD hh:mm:ss";if("number"!=typeof t)throw new Error("[timesToDate]: timestamp must be number");e&&"string"==typeof e&&(i=e);var o=t||Date.now(),n=new Date(o)||new Date(o),r=n.getFullYear(),s=n.getMonth()+1,a=n.getDate(),h=n.getHours(),l=n.getMinutes(),c=n.getSeconds(),d=n.getMilliseconds();return i.indexOf("YYYY")>-1&&(i=i.replace("YYYY",(function(t){return""+r}))),i.indexOf("MM")>-1?i=i.replace("MM",(function(t){return s<10?"0"+s:""+s})):i.indexOf("M")>-1&&(i=i.replace("M",(function(t){return""+s}))),i.indexOf("DD")>-1?i=i.replace("DD",(function(t){return a<10?"0"+a:""+a})):i.indexOf("D")>-1&&(i=i.replace("D",(function(t){return""+a}))),i.indexOf("hh")>-1?i=i.replace("hh",(function(t){return h<10?"0"+h:""+h})):i.indexOf("h")>-1&&(i=i.replace("h",(function(t){return""+h}))),i.indexOf("mm")>-1?i=i.replace("mm",(function(t){return l<10?"0"+l:""+l})):i.indexOf("m")>-1&&(i=i.replace("m",(function(t){return""+l}))),i.indexOf("ss")>-1?i=i.replace("ss",(function(t){return c<10?"0"+c:""+c})):i.indexOf("s")>-1&&(i=i.replace("s",(function(t){return""+c}))),i.indexOf("ms")>-1&&(i=i.replace("ms",(function(){return""+d}))),i.indexOf("AP")>-1&&(i=i.replace("AP",(function(){return h>12?"PM":"AM"}))),i},L=function(t,e){return Math.round(Number(t+"e"+e))/Math.pow(10,e)},P=function(t,e){var i=a(t,4),o=i[0],n=i[1],r=i[2],s=i[3],h=e||30,l=180*Math.atan2(n-s,o-r)/Math.PI,c=(l+30)*Math.PI/180,d=(l-30)*Math.PI/180;return[[o,n],[r,s],[r+h*Math.cos(c),s+h*Math.sin(c)],[r+h*Math.cos(d),s+h*Math.sin(d)]]};!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=3]="ERROR",t[t.NONE=4]="NONE"}(g||(g={}));var M=function(){function t(){this.logPrefix="SupLogger",this.logLevel=g.NONE,this.uploadServeTranslators=[],this.DEBUG=g.DEBUG,this.INFO=g.INFO,this.WARNING=g.WARNING,this.ERROR=g.ERROR,this.NONE=g.NONE}return t.prototype.setLogLevel=function(t,e){e&&(this.logPrefix=e),"number"==typeof t&&t>-1&&t<5&&(this.logLevel=t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>g.ERROR&&this.logLevel!==g.NONE||this.logLevel===g.NONE)){var i=t,o=Date.now();i.unshift("["+w(o,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [ERROR]:%c","color: #b00020; font-weight: bold;","color: #dc3545;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"error",params:i,timestamp:o},(function(){console.error.apply(console,i)}))})):console.error.apply(console,i)}},t.prototype.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>g.WARNING&&this.logLevel!==g.NONE||this.logLevel===g.NONE)){var i=t,o=Date.now();i.unshift("["+w(o,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [WARNING]:","color: #ffc107; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"warning",params:i,timestamp:o},(function(){console.warn.apply(console,i)}))})):console.warn.apply(console,i)}},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>g.INFO&&this.logLevel!==g.NONE||this.logLevel===g.NONE)){var i=t,o=Date.now();i.unshift("["+w(o,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [INFO]:","color:  #007bff; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"info",params:i,timestamp:o},(function(){console.log.apply(console,i)}))})):console.log.apply(console,i)}},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!(this.logLevel>g.DEBUG&&this.logLevel!==g.NONE||this.logLevel===g.NONE)){var i=t,o=Date.now();i.unshift("["+w(o,"hh:mm:ss.ms")+"] %c"+this.logPrefix+" [DEBUG]:","color:#6facff;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(t){t({type:"debug",params:i,timestamp:o},(function(){console.log.apply(console,i)}))})):console.log.apply(console,i)}},t}(),k=new M;k.setLogLevel(k.DEBUG,"anyRTC-SDK");var W=Array.prototype,U=function(){function t(){this._events={},this.addListener=this.on}return t.prototype.getListeners=function(t){return this._events[t]?W.map.call(this._events[t],(function(t){return t.listener})):[]},t.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];-1===this._indexOfListener(i,e)&&i.push({listener:e,once:!1})},t.prototype.once=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];-1===this._indexOfListener(i,e)&&i.push({listener:e,once:!0})},t.prototype.off=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t],o=this._indexOfListener(i,e);-1!==o&&W.splice.call(i,o,1)},t.prototype.removeAllListeners=function(t){t?delete this._events[t]:this._events={}},t.prototype.emit=function(t){for(var e,i,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];this._events[t]||(this._events[t]=[]);var r=this._events[t];try{for(var a=s(r),h=a.next();!h.done;h=a.next()){var l=h.value;l.once&&this.off(t,l.listener),l.listener.apply(this,o||[])}}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},t.prototype._indexOfListener=function(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1},t}(),G="data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg width='36px' height='36px' viewBox='0 0 36 36' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3epen%3c/title%3e %3cdefs%3e %3cpath d='M11.058%2c18.43405 C11.254%2c18.23905 11.571%2c18.23905 11.766%2c18.43405 L11.766%2c18.43405 L17.374%2c24.04305 C17.472%2c24.14005 17.521%2c24.26805 17.521%2c24.39605 C17.521%2c24.52505 17.472%2c24.65305 17.374%2c24.75005 L17.374%2c24.75005 L7.463%2c34.72705 C7.369%2c34.82105 7.242%2c34.87405 7.109%2c34.87405 L7.109%2c34.87405 L1.501%2c34.87405 C1.224%2c34.87405 1%2c34.65005 1%2c34.37305 L1%2c34.37305 L1%2c28.76505 C1%2c28.63205 1.053%2c28.50505 1.147%2c28.41105 L1.147%2c28.41105 Z M14.546%2c14.94725 C15.808%2c13.68425 17.855%2c13.68425 19.118%2c14.94725 L19.118%2c14.94725 L20.862%2c16.69125 C21.493%2c17.32225 21.809%2c18.14925 21.809%2c18.97725 C21.809%2c19.80425 21.493%2c20.63225 20.862%2c21.26325 L20.862%2c21.26325 L19.815%2c22.31025 C19.618%2c22.50725 19.299%2c22.50725 19.102%2c22.31025 L19.102%2c22.31025 L13.498%2c16.70625 C13.4%2c16.60825 13.351%2c16.47925 13.351%2c16.35025 C13.351%2c16.22125 13.4%2c16.09225 13.498%2c15.99425 L13.498%2c15.99425 Z' id='path-1'%3e%3c/path%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-1605.000000%2c -264.000000)'%3e %3cg transform='translate(1605.000000%2c 264.000000)'%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='%235A5A67' fill-rule='evenodd' xlink:href='%23path-1'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-1'%3e%3c/use%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/svg%3e",H="data:image/svg+xml,%3c%3fxml version='1.0' encoding='UTF-8'%3f%3e%3csvg width='36px' height='36px' viewBox='0 0 36 36' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e %3ctitle%3eeraser%3c/title%3e %3cdefs%3e %3cpath d='M14.6360447%2c18.6364913 C14.6421156%2c18.6422645 14.6481137%2c18.6481137 14.6540377%2c18.6540377 L21.7486317%2c25.7486317 C22.1225567%2c26.1225567 22.1407196%2c26.7229667 21.7900807%2c27.1188103 L14.8088531%2c34.9991425 L4.31285305%2c34.9991425 L1.38518552%2c32.7112376 C0.950000977%2c32.3711893 0.872877826%2c31.7427389 1.21292614%2c31.3075543 C1.23283318%2c31.2820778 1.25396405%2c31.2575818 1.27624429%2c31.2341525 L13.2222777%2c18.6720307 C13.6028647%2c18.2718158 14.2358298%2c18.2559043 14.6360447%2c18.6364913 Z' id='path-1'%3e%3c/path%3e %3crect id='path-2' x='11.736544' y='17.6066017' width='14' height='8' rx='1'%3e%3c/rect%3e %3c/defs%3e %3cg stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e %3cg transform='translate(-1664.000000%2c -264.000000)'%3e %3cg transform='translate(1664.000000%2c 264.000000)'%3e %3cg%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='%235A5A67' fill-rule='evenodd' xlink:href='%23path-1'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-1'%3e%3c/use%3e %3c/g%3e %3cg transform='translate(18.736544%2c 21.606602) rotate(-315.000000) translate(-18.736544%2c -21.606602) '%3e %3cuse stroke='%235A5A67' stroke-width='2' fill='white' fill-rule='evenodd' xlink:href='%23path-2'%3e%3c/use%3e %3cuse stroke='white' stroke-width='1' xlink:href='%23path-2'%3e%3c/use%3e %3c/g%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/svg%3e",F=function(){var t,e,i=navigator.userAgent;try{for(var o=s(["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"]),n=o.next();!n.done;n=o.next()){var r=n.value;if(i.indexOf(r)>=0)return!0}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return!1},K=function(e){function n(i,n){var r,s=e.call(this)||this;if(s.options={width:1920,height:1080,backgroundColor:"#ffffff",backgroundImage:"",ratio:"16:9",scale:100},s._boxWidth=0,s._boxHeight=0,s._width=0,s._height=0,s._controlBoxPosition=[0,0,0,0],s.selectStartPosition=[],s.selectLatestMovePosition=[],s._cursor=t.BoardToolType.NONE,s._cursorMap=new Map,s._handleMouseDown=function(){},s._handleMouseUp=function(){},s._handleControlBoxMouseDown=function(){},s._handleControlBoxMouseMove=function(){},s._handleControlBoxMouseUp=function(){},i instanceof HTMLElement)r=i;else{if("string"!=typeof i||!document.querySelector("#"+i))throw new TypeError("selector must be HTMLElement or Element id");r=document.querySelector("#"+i)}s._rootDom=r,s.options=o(o({},s.options),{width:s._rootDom.clientWidth,height:s._rootDom.clientHeight});var a=n.ratio,h=n.scale,l=n.backgroundColor,c=n.backgroundImage;return a&&(s.options.ratio=a),h&&(s.options.scale=h),l&&(s.options.backgroundColor=l),c&&(s.options.backgroundImage=c),s._calculateCanvasWidthAndHeight(),s.initBuildInCursor(),s.init(),s}return i(n,e),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"boxWidth",{get:function(){return this._boxWidth},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"boxHeight",{get:function(){return this._boxHeight},enumerable:!1,configurable:!0}),n.prototype.initBuildInCursor=function(){this._cursorMap.set(t.BoardToolType.NONE,{cursor:"default",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.ARROW,{cursor:"crosshair",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.ELLIPSE,{cursor:"crosshair",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.ERASER,{cursor:"url",url:H,width:"24",height:"24",offsetX:0,offsetY:-24}),this._cursorMap.set(t.BoardToolType.FREE_DRAW,{cursor:"url",url:G,width:"24",height:"24",offsetX:0,offsetY:-24}),this._cursorMap.set(t.BoardToolType.LASER_POINTER,{cursor:"none",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.LINE,{cursor:"crosshair",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.RECT,{cursor:"crosshair",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.SELECT,{cursor:"crosshair",url:"",width:"24",height:"24",offsetX:0,offsetY:0}),this._cursorMap.set(t.BoardToolType.TEXT,{cursor:"text",url:"",width:"24",height:"24",offsetX:0,offsetY:0})},n.prototype.init=function(){var t=A({key:"canvasBox",kind:"div",props:{class:"board_wrap"},style:{position:"relative",width:this._boxWidth+"px",height:this._boxHeight+"px",top:this._rootDom.offsetHeight/2+"px",left:this._rootDom.offsetWidth/2+"px",transform:"translate(-50%, -50%)",padding:"0px",margin:"0px","border-width":"0px",cursor:"default",overflow:"hidden"},children:[{key:"cacheCanvas",kind:"canvas",props:{class:"board-cache_canvas",width:this._width,height:this._height},style:{position:"absolute",left:"0px",top:"0px",width:this._width+"px",height:this._height+"px",userSelect:"none",padding:"0px","margin-top":"0px","margin-left":"0px",borderWidth:"0px","z-index":10,PointerEvent:"none"},children:[]},{key:"canvas",kind:"canvas",props:{class:"board_canvas",width:this._width,height:this._height},style:{position:"absolute",left:"0px",top:"0px",width:this._width+"px",height:this._height+"px",userSelect:"none",padding:"0px","margin-top":"0px","margin-left":"0px",borderWidth:"0px","z-index":10},children:[]},{key:"canvasBackgroundImage",kind:"img",props:{class:"board_background_image"},style:{position:"absolute",left:"0px",top:"0px",visibility:"hidden","z-index":5},children:[]},{key:"canvasBackground",kind:"div",props:{class:"board_background_wrap",width:"100%",height:"100%"},style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",padding:"0px",margin:"0px",cursor:"none","z-index":4,"background-color":this.options.backgroundColor},children:[]},{key:"cursorWrap",kind:"div",props:{class:"cursor_wrap_view",width:"100%",height:"100%"},style:{position:"absolute",left:"50%",top:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",border:"none","z-index":11,"pointer-events":"none"},children:[]},{key:"controlWrap",kind:"div",props:{class:"control_wrap_view",width:"100%",height:"100%"},style:{position:"absolute",display:"none",left:"50%",top:"50%",width:"100%",height:"100%",border:"none","user-select":"none",transform:"translate(-50%, -50%)","z-index":0},children:[{key:"controlBox",kind:"div",style:{position:"absolute",border:"1px dashed rgb(136, 136, 136)",cursor:"move",visibility:"visible",transform:"translateX(0px) translateY(0px) rotate(0deg)"},children:[]}]},{key:"loading",kind:"div",props:{class:"board_loading"},style:{position:"absolute",display:"none",left:"50%",top:"50%",transform:"translate(-50%, -50%)",overflow:"hidden","z-index":200},children:[]},{key:"textBox",kind:"div",props:{class:"board_text_box",width:"100%",height:"100%"},style:{position:"absolute",left:"50%",top:"50%",width:"100%",height:"100%",border:"none",transform:"translate(-50%, -50%)","z-index":9,overflow:"hidden"},children:[{key:"textInput",kind:"textarea",props:o({class:"board-text_input"},v.TEXT_INPUT_ELEMENT_OPTIONS.props),style:o(o({},v.TEXT_INPUT_ELEMENT_OPTIONS.style),{visibility:"hidden"})}]},{key:"canvasH5",kind:"iframe",props:{class:"board_webview",width:"100%",height:"100%"},style:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",border:"none","z-index":8},children:[]}]}),e=t.el,i=t.canvasBox,n=t.canvas,r=t.cacheCanvas,s=t.canvasBackground,a=t.canvasBackgroundImage,h=t.textBox;t.textInput;var l=t.cursorWrap,c=t.loading,d=t.controlWrap,p=t.controlBox;this._rootDom.appendChild(e),this._canvasBox=i,this._canvas=n,this._cacheCanvas=r,this._canvasBgWrap=s,this._canvasBgImg=a,this._cursorWrap=l,this._loading=c,this._loading.innerHTML=v.LOADING_ICON,this._textBox=h,this._controlWrap=d,this._controlBox=p,this._canvasCtx=n.getContext("2d"),this._cacheCanvasCtx=r.getContext("2d"),this._handleControlBoxMouseDown=this.handleControlBoxMouseDown.bind(this),this._handleControlBoxMouseMove=this.handleControlBoxMouseMove.bind(this),this._handleControlBoxMouseUp=this.handleControlBoxMouseUp.bind(this),this._controlWrap.ontouchstart=this._controlWrap.onmousedown=this._handleControlBoxMouseDown,this._controlWrap.ontouchmove=this._controlWrap.onmousemove=this._handleControlBoxMouseMove,this._controlWrap.ontouchend=this._controlWrap.onmouseup=this._controlWrap.onmouseout=this._handleControlBoxMouseUp,this._canvas.oncontextmenu=function(t){t.preventDefault(),t.stopPropagation()},this.startHandleMoveEvent()},n.prototype.destroy=function(){this._rootDom.innerHTML=""},n.prototype.getSnapShortImage=function(){return this._canvas.toDataURL("image/png")},n.prototype.appendChild=function(t){this._canvasBox.appendChild(t)},n.prototype.setCursor=function(t){this._cursor=t},n.prototype.setCanvasBGColor=function(t){this.options.backgroundColor=t,this._canvasBgWrap.style.backgroundColor=t},n.prototype.setCanvasBGImage=function(t){t?(this._canvasBgImg.src=t,this._canvasBgImg.style.visibility="visible"):(this._canvasBgImg.removeAttribute("src"),this._canvasBgImg.style.visibility="hidden")},n.prototype.createTextInput=function(t){this._textBox.appendChild(t)},n.prototype.showControlWrap=function(){this._controlWrap.style.display="block",this._controlWrap.style.zIndex="100"},n.prototype.hideControlWrap=function(){this._controlWrap.style.display="block",this._controlWrap.style.zIndex="0"},n.prototype.setControlBoxSize=function(t){var e=t[0],i=t[1],o=t[2],n=t[3];this._controlBox.style.width=o-e+"px",this._controlBox.style.height=n-i+"px",this.setControlBoxPosition(t)},n.prototype.setControlBoxPosition=function(t){var e=(this.boxWidth-this.width)/2,i=(this.boxHeight-this.height)/2,o=t[0]+e,n=t[1]+i;this._controlBoxPosition=t,this._controlBox.style.transform="translateX("+o+"px) translateY("+n+"px) rotate(0deg)"},n.prototype.showLoading=function(){this._loading.style.display="block"},n.prototype.hideLoading=function(){this._loading.style.display="none"},n.prototype.renderSize=function(){this._calculateCanvasWidthAndHeight(),this._canvasBox.style.width=this._boxWidth+"px",this._canvasBox.style.height=this._boxHeight+"px",this._canvasBox.style.top=this._rootDom.offsetHeight/2+"px",this._canvasBox.style.left=this._rootDom.offsetWidth/2+"px",this._canvas.width=this._cacheCanvas.width=this._width,this._canvas.height=this._cacheCanvas.height=this._height,this._canvas.style.width=this._cacheCanvas.style.width=this._width+"px",this._canvas.style.height=this._cacheCanvas.style.height=this._height+"px",this._boxWidth>this._width?(this._canvas.style.marginTop=this._cacheCanvas.style.marginTop=(this._boxHeight-this._height)/2+"px",this._canvas.style.marginLeft=this._cacheCanvas.style.marginLeft=(this._boxWidth-this._width)/2+"px"):(this._canvas.style.marginTop=this._cacheCanvas.style.marginTop="0px",this._canvas.style.marginLeft=this._cacheCanvas.style.marginLeft="0px")},n.prototype.startHandleMoveEvent=function(){this._handleMouseDown=this.handleMouseDown.bind(this),this._handleMouseMove=this.handleMouseMove.bind(this),this._handleMouseUp=this.handleMouseUp.bind(this),this._handleMouseOut=this.handleMouseOut.bind(this),F()?(this._canvas.addEventListener("touchstart",this._handleMouseDown,!1),this._canvas.addEventListener("touchmove",this._handleMouseMove,!1),this._canvas.addEventListener("touchend",this._handleMouseUp,!1)):(this._canvas.addEventListener("mouseenter",this._handleMouseDown,!1),this._canvas.addEventListener("mousedown",this._handleMouseDown,!1),this._canvas.addEventListener("mousemove",this._handleMouseMove,!1),this._canvas.addEventListener("mouseup",this._handleMouseUp,!1),this._canvas.addEventListener("mouseout",this._handleMouseUp,!1))},n.prototype._handleMouseMove=function(t){var e=0,i=0;if(t instanceof MouseEvent)e=t.offsetX,i=t.offsetY;else if(t instanceof TouchEvent){var o=this._canvas.getBoundingClientRect();e=t.touches[0].clientX-o.left,i=t.touches[0].clientY-o.top}var n=(this.boxWidth-this.width)/2,r=(this.boxHeight-this.height)/2,s=this._cursorMap.get(this._cursor);if(s){var a=s.cursor,h=s.url,l=s.width,c=s.height,d=s.offsetX,p=s.offsetY;if("url"===a){var u=new Image,_=this._cursorWrap.querySelector("img");(!_||_&&_.src!==h)&&(this._cursorWrap.innerHTML="",u.src=h,u.style.width=l+"px",u.style.height=c+"px",u.style.transform="translate("+(e+d)+"px, "+(i+p)+"px) scale(1.0)",u.onload=function(){},u.onerror=function(t){},this._cursorWrap.append(u)),_&&(_.style.transform="translate("+(e+d+n)+"px, "+(i+p+r)+"px) scale(1.0)"),this._canvas.style.cursor="none"}else this._cursorWrap.innerHTML="",this._canvas.style.cursor=a}this.handleMouseMove&&this.handleMouseMove.call(this,t)},n.prototype._handleMouseOut=function(t){this._cursorWrap.innerHTML="",this.handleMouseOut&&this.handleMouseOut.call(this,t)},n.prototype.stopHandleMoveEvent=function(){F()?(this._canvas.removeEventListener("touchstart",this._handleMouseDown,!1),this._canvas.removeEventListener("touchmove",this._handleMouseMove,!1),this._canvas.removeEventListener("touchend",this._handleMouseUp,!1)):(this._canvas.removeEventListener("mousedown",this._handleMouseDown,!1),this._canvas.removeEventListener("mousemove",this._handleMouseMove,!1),this._canvas.removeEventListener("mouseup",this._handleMouseUp,!1),this._canvas.removeEventListener("mouseout",this._handleMouseUp,!1))},n.prototype._calculateCanvasWidthAndHeight=function(){var t=this.options,e=t.ratio,i=t.scale,o=a(e.split(":"),2),n=o[0],r=o[1],s=this._rootDom.offsetWidth,h=this._rootDom.offsetHeight,l=0;l=s*r/n<h?s:h*n/r,this._boxWidth=l*(i/100),this._boxHeight=this._boxWidth*r/n;var c=window.screen.width,d=0,p=0,u=this._boxWidth<c?this._boxWidth:c,_=u*r/n;d=u,p=_,_>h&&(d=h*n/r,p=h),this._width=d,this._height=p},n.prototype._prevent=function(t){t.preventDefault()},n.prototype.handleMouseDown=function(t){},n.prototype.handleMouseMove=function(t){},n.prototype.handleMouseUp=function(t){},n.prototype.handleMouseOut=function(t){},n.prototype.handleControlBoxMouseDown=function(t){},n.prototype.handleControlBoxMouseMove=function(t){},n.prototype.handleControlBoxMouseUp=function(t){},n.prototype.handleControlBoxMouseOut=function(t){},n.basicWidth=1920,n.basicHeight=1080,n}(U),V={Arrow:T,Circle:C,Ellipse:m,FreeDraw:b,LaserPointer:I,Line:D,Rect:N,Text:O},Y=function(){function t(t,e,i){void 0===e&&(e=""),this.name="ArWhiteBoardException",this.code=t;var o="ArWhiteBoardError".concat(" ").concat(this.code,": ");this.message=e?o.concat(e):o,this.data=i}return t.prototype.toString=function(){return this.data?"".concat(this.message," data: ").concat(JSON.stringify(this.data)):this.message},t}(),z=2e3,j=function(e){function n(i,o){var n=e.call(this,i,o)||this;if(n._id="",n.uid="",n._enabled=!0,n._toolType=t.BoardToolType.NONE,n._brushColor="#000000",n._brushThin=5,n._textSize=16,n._textColor="#333333",n._selectBoxColor="#ababab",n._brushCursor="default",n._selectShapes=[],n._laserPointer=null,n._textInput=null,n._temporaryList=new Map,n._displayList=new Map,n._canRedoList=[],n._canUndoList=[],n._mouseDown=!1,n._startPosition=[0,0],n._endPosition=[0,0],n._latestMovePosition=[],n._currentShape=null,n._selectShape=null,n._needUpdateShapeData=null,o){var r=o.brushColor,s=o.brushThin;o.scale;var a=o.textSize,h=o.textColor,l=o.selectBoxColor;r&&(n._brushColor=r),s&&(n._brushThin=s),a&&(n._textSize=a),h&&(n._textColor=h),l&&(n._selectBoxColor=l)}return n}return i(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canUndoList",{get:function(){return this._canUndoList},set:function(t){this._canUndoList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canRedoList",{get:function(){return this._canRedoList},set:function(t){this._canRedoList=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushColor",{get:function(){return this._brushColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushType",{get:function(){return this._toolType},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushThin",{get:function(){return this._brushThin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"backgroundColor",{get:function(){return this.options.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"brushId",{get:function(){return this.uid+"_"+Date.now()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectPenId",{get:function(){return"selector_"+(z+=1)},enumerable:!1,configurable:!0}),n.prototype.setEnable=function(t){"boolean"==typeof t?this._enabled!==t&&(this._enabled=t,k.info("set board enable as "+t)):k.info("set board enable failed")},n.prototype.getEnable=function(){return this._enabled},n.prototype.getNeedUpdateShapeData=function(){var t=this._needUpdateShapeData;return this._needUpdateShapeData=null,t},n.prototype.setBrushType=function(e){var i=this;if(e!==t.BoardToolType.NONE&&e!==t.BoardToolType.SELECT&&e!==t.BoardToolType.FREE_DRAW&&e!==t.BoardToolType.TEXT&&e!==t.BoardToolType.RECT&&e!==t.BoardToolType.LINE&&e!==t.BoardToolType.ELLIPSE&&e!==t.BoardToolType.ARROW&&e!==t.BoardToolType.ERASER&&e!==t.BoardToolType.LASER_POINTER)throw new Y(E.INVALID_PARAMS);k.info("set brush type as "+e),this._setBrushCursor(e),this._selectShapes.length>0&&(this._displayList.forEach((function(t,e){i._selectShapes.includes(e)&&i.drawToCachePainter(t)})),this._selectShapes=[],this.hideControlWrap(),this._renderTemporaryCanvas())},n.prototype.setBrushColor=function(t){if("string"!=typeof t)throw new Y(E.INVALID_PARAMS);k.info("set brush color as "+t),this._brushColor=t},n.prototype.setBrushThin=function(t){if(!("number"==typeof t&&t>=1&&t<=20))throw new Y(E.INVALID_PARAMS);this._brushThin=t,k.info("set brush thin as "+t)},n.prototype.setTextStyle=function(){},n.prototype.getTextStyle=function(){},n.prototype.setLineStyle=function(){},n.prototype.getLineStyle=function(){},n.prototype.setTextSize=function(t){this._textSize=t},n.prototype.getTextSize=function(){return this._textSize},n.prototype.setTextColor=function(t){this._textColor=t},n.prototype.getTextColor=function(){return this._textColor},n.prototype.setBoardRatio=function(t){this.options.ratio=t,this.renderSize()},n.prototype.getBoardRatio=function(){return this.options.ratio},n.prototype.setSelectBoxColor=function(t){this._selectBoxColor=t},n.prototype.scalePainter=function(t){this.options.scale=t,this.renderSize()},n.prototype.undo=function(){var t=this._canUndoList.pop();if(t){var e=t.type;t.shapes,this._canRedoList.push(t),this._selectShapes=[],this.renderControlBox();var i=t.shapes[0],o=new V[i.type](i.id,{props:i._props,position:i.position,style:i.style}),n=void 0;if(e===c.ADD_SHAPE){var r={pIds:[o.id]};n={bId:this.id,action:c.DELETE_SHAPE,data:r},this.removeElement(o.id)}else if(e===c.DELETE_SHAPE){var s={pId:o.id,shape:o.type,props:o.props,position:o.position,style:o.style,width:this.width,height:this.height,lts:Date.now()};n={bId:this.id,action:c.ADD_SHAPE,data:s},this.addElement(o)}else if(e===c.MOVE_SHAPE){var h=t.offset,l=t.shapes,d=a(h,2),p=d[0],u=d[1];this.moveElement(l.map((function(t){return t.id})),[-1*p*this.width,-1*u*this.height]);var _={pIds:l.map((function(t){return t.id})),offset:[-1*p,-1*u]};n={bId:this.id,action:c.MOVE_SHAPE,data:_}}this.emit("reportContent",n)}},n.prototype.redo=function(){var t=this._canRedoList.pop();if(t){this._canUndoList.push(t);var e=t.shapes[0],i=new V[e.type](e.id,{props:e._props,position:e.position,style:e.style}),o=void 0;if(t.type===c.ADD_SHAPE){var n={pId:i.id,shape:i.type,props:i.props,position:i.position,style:i.style,width:this.width,height:this.height,lts:Date.now()};o={bId:this.id,action:c.ADD_SHAPE,data:n},this.addElement(i)}else if(t.type===c.DELETE_SHAPE){var r={pIds:[i.id]};o={bId:this.id,action:c.DELETE_SHAPE,data:r},this.removeElement(i.id)}else if(t.type===c.MOVE_SHAPE){var s=t.offset,h=t.shapes,l=a(s,2),d=l[0],p=l[1];this.moveElement(h.map((function(t){return t.id})),[d*this.width,p*this.height]);var u={pIds:h.map((function(t){return t.id})),offset:[d,p]};o={bId:this.id,action:c.MOVE_SHAPE,data:u}}this.emit("reportContent",o)}},n.prototype.addElement=function(t){if(this._displayList.get(t.id))throw Error("can not add again");this._temporaryList.get(t.id)||(t instanceof I?t.buildElement(this._cursorWrap):this.drawToCachePainter(t),this._displayList.set(t.id,t))},n.prototype.removeElement=function(t){var e=this,i=this._displayList.get(t);if(i){this._displayList.delete(t);var o=this._selectShapes.findIndex((function(e){return e===t}));~o&&this._selectShapes.splice(o,1),this.renderControlBox(),i instanceof I?document.querySelectorAll(".board-laser_item").forEach((function(e){e.getAttribute("data-uid")===t&&e.remove()})):(this.clearCachePainter(),this._displayList.forEach((function(t){e.drawToCachePainter(t)})))}},n.prototype.moveElement=function(t,e){var i=this,o=a(e,2),n=o[0],r=o[1];this.clearCachePainter(),this._displayList.forEach((function(e,o){t.includes(e.id)?(null==e?void 0:e.type)===l.LASER_POINTER?(null==e||e.attr("position",[n,r]),e.setPosition(n,r)):(null==e||e.attr("position",[e.position[0]+n,e.position[1]+r]),i.drawToCachePainter(e)):i.drawToCachePainter(e)}))},n.prototype.refreshElement=function(t){var e=this._displayList.get(t);e&&e.buildPath(this._canvasCtx,e)},n.prototype.findElement=function(t){return this._displayList.get(t)},n.prototype.renderControlBox=function(){var t=this;if(this._selectShapes.length>0){var e=[],i=[],o=[],n=[];this._selectShapes.forEach((function(r){var s=t._displayList.get(r),a=null==s?void 0:s.getBoundingRect();e.push(a.x),i.push(a.y),o.push(a.x+a.width),n.push(a.y+a.height)})),this._controlBoxPosition=[Math.min.apply(Math,h([],a(e))),Math.min.apply(Math,h([],a(i))),Math.max.apply(Math,h([],a(o))),Math.max.apply(Math,h([],a(n)))],this.setControlBoxSize(this._controlBoxPosition),this.showControlWrap()}else this.hideControlWrap()},n.prototype.clearCanvas=function(){this.clearPainter(),this.clearCachePainter(),this._displayList.clear()},n.prototype.clearLaserPoint=function(){var t=this;this._displayList.forEach((function(e){e instanceof I&&e.id!==t.uid&&document.querySelectorAll(".board-laser_item").forEach((function(t){t.getAttribute("data-uid")===e.id&&t.remove()}))}))},n.prototype.clear=function(t){void 0===t&&(t=!1),this.clearPainter(),this.clearCachePainter(),this._displayList.clear(),t||(this._selectShapes=[],this.hideControlWrap())},n.prototype.reset=function(){this.clearPainter(),this.clearCachePainter(),this._displayList.clear(),this._temporaryList.clear(),this._canUndoList=[],this._canRedoList=[],this._selectShape&&(this._selectShape=null),this._currentShape&&(this._toolType===t.BoardToolType.FREE_DRAW?this._currentShape.props.points.length>1?(this._canUndoList.push({type:c.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null):this.removeElement(this._currentShape.id):(this._canUndoList.push({type:c.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null),this._currentShape=null)},n.prototype.clearAll=function(){this.clear(),this._canUndoList=[],this._canRedoList=[],this._cursorWrap.innerHTML=""},n.prototype.clearBackground=function(){this.setCanvasBGColor("#ffffff"),this.setCanvasBGImage("")},n.prototype._initCurrentShape=function(e,i){var n=this,r={};if(this._startPosition=[e,i],this._toolType===t.BoardToolType.SELECT){var s=new N(this.selectPenId,{props:{x1:e,y1:i,x2:e,y2:i},style:o(o({},v.BOARD_SELECT_STYLE),{strokeStyle:this._selectBoxColor})});this._selectShape=this._createProxySetHandle(s,(function(t,e,i,o){if("props"===e||"position"===e||"style"===e){t[e]=i;var r=n._controlBoxPosition[0],s=n._controlBoxPosition[1],a=n._controlBoxPosition[2],h=n._controlBoxPosition[3];n._selectShapes=[];var l=t.getBoundingRect(),c=[l.x,l.y,l.x+l.width,l.y+l.height];n._displayList.forEach((function(t,e){var i,o,l,d,p,u,_,f,v,E,y=t.getBoundingRect(),g=[y.x,y.y,y.x+y.width,y.y+y.height];if(o=g,l=(i=c)[0],d=i[1],p=i[2],u=i[3],_=o[0],f=o[1],v=o[2],E=o[3],l<=_&&d<=f&&v<=p&&E<=u){var S=t.getBoundingRect();0===n._selectShapes.length&&(r=S.x,s=S.x+S.width,a=S.y,h=S.y+S.height),r=r<S.x?r:S.x,s=s<S.x+S.width?S.x+S.width:s,a=a<S.y?a:S.y,h=h<S.y+S.height?S.y+S.height:h,n._selectShapes.push(t.id)}})),n._controlBoxPosition=[r,a,s,h],n.clearPainter(),n._renderTemporaryCanvas(),n._drawToPainter(t)}}))}else if(this.brushType===t.BoardToolType.FREE_DRAW){(c=[]).push(h([],a(this._startPosition))),r={points:c};var l=new b(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=l}else if(this._toolType===t.BoardToolType.ARROW){var c=h(h([],a(this._startPosition)),a(this._startPosition));r={points:P(c,2.5*this._brushThin)};var d=new T(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=d}else if(this._toolType===t.BoardToolType.LINE){r={x:this._startPosition[0],y:this._startPosition[1],x1:this._startPosition[0],y1:this._startPosition[1]};var p=new D(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=p}else if(this._toolType===t.BoardToolType.RECT){r={x1:e,y1:i,x2:e,y2:i};var u=new N(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=u}else if(this._toolType===t.BoardToolType.ELLIPSE){r={cx:this._startPosition[0],cy:this._startPosition[1],xr:0,yr:0};var _=new m(this.brushId,{props:r,style:{lineWidth:this._brushThin,strokeStyle:this._brushColor}});this._currentShape=_}this._currentShape&&this._toolType!==t.BoardToolType.SELECT&&this._temporaryList.set(this._currentShape.id,this._currentShape)},n.prototype.handleMouseDown=function(e){if(this._toolType!==t.BoardToolType.NONE&&this._enabled){var i=0,o=0;if(e instanceof MouseEvent)i=e.offsetX,o=e.offsetY;else if(e instanceof TouchEvent){var n=this._canvas.getBoundingClientRect();i=e.touches[0].clientX-n.left,o=e.touches[0].clientY-n.top}var r=L(Math.floor(i),1),s=L(Math.floor(o),1);if(this._toolType===t.BoardToolType.LASER_POINTER){if(e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mouseenter"===e.type){var a=new I(this.uid+"LaserPointer",{props:{cx:r,cy:s,r:10}});this._laserPointer=a,this._laserPointer.buildElement(this._cursorWrap);var h={pId:a.id,width:this.width,height:this.height,shape:a.type,props:a.props,style:a.style,position:a.position,lts:Date.now()},l={bId:this.id,action:c.ADD_SHAPE,data:h};this.emit("reportContent",l)}}else if(this._toolType===t.BoardToolType.ERASER||this._toolType===t.BoardToolType.TEXT)(e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mousedown"===e.type&&0===e.button)&&(this._toolType===t.BoardToolType.ERASER?this._eraserShape(r,s):this._toolType===t.BoardToolType.TEXT&&(e.preventDefault(),e.stopPropagation(),this._textInput?(this._textInput.blur(),this._textInput=null):this._createTextInputAndHandleChange(r,s)));else if(this._toolType!==t.BoardToolType.SELECT){if(e instanceof MouseEvent&&"mouseenter"===e.type)return;(e instanceof TouchEvent&&"touchstart"===e.type||e instanceof MouseEvent&&"mousedown"===e.type&&e.buttons%2!=0)&&(this._startPosition=[r,s],!this._currentShape&&this._initCurrentShape(r,s))}}},n.prototype.handleMouseMove=function(e){var i,n,r,s,l,d,p,u,_,f,v,E,y,g;if(this._enabled&&this._toolType!==t.BoardToolType.NONE){var S=0,T=0;if(e instanceof MouseEvent)S=e.offsetX,T=e.offsetY;else if(e instanceof TouchEvent){var C=this._canvas.getBoundingClientRect();S=e.touches[0].clientX-C.left,T=e.touches[0].clientY-C.top}var m=L(Math.floor(S),1),b=L(Math.floor(T),1),A=[m,b];if(this._toolType===t.BoardToolType.LASER_POINTER){if(this._laserPointer instanceof I&&(e instanceof TouchEvent&&"touchmove"===e.type||e instanceof MouseEvent&&"mousemove"===e.type)){0===this._latestMovePosition.length&&(this._latestMovePosition=[m,b]);var D=m-this._latestMovePosition[0],N=b-this._latestMovePosition[1];this._latestMovePosition=[m,b],this._laserPointer.setPosition(this._laserPointer.position[0]+D,this._laserPointer.position[1]+N);var R={pIds:[this._laserPointer.id],offset:[this._laserPointer.position[0]/this.width,this._laserPointer.position[1]/this.height]},B={bId:this.id,action:c.MOVE_SHAPE,data:R};this._needUpdateShapeData=B}}else if(this._toolType===t.BoardToolType.SELECT&&(e instanceof TouchEvent&&"touchmove"===e.type||e instanceof MouseEvent&&"mousemove"===e.type&&e.buttons%2!=0))!this._selectShape&&this._initCurrentShape(m,b),this._selectShape.attr("props",{x2:A[0],y2:A[1]});else if(this._toolType!==t.BoardToolType.ERASER&&this._toolType!==t.BoardToolType.TEXT&&this._currentShape){var x=this._currentShape.style,O=x.strokeStyle;x.fillStyle;var w={};O&&(w.strokeStyle=this._brushColor),null===(i=this._currentShape)||void 0===i||i.attr("style",w);var M={pId:this._currentShape.id,shape:this._currentShape.type,style:this._currentShape.style,props:this._needUpdateShapeData?null===(r=null===(n=this._needUpdateShapeData)||void 0===n?void 0:n.data)||void 0===r?void 0:r.props:{},width:this.width,height:this.height,position:[0,0],lts:Date.now()};B={bId:this.id,action:c.ADD_SHAPE,data:M};if(this._toolType===t.BoardToolType.FREE_DRAW){var k=(null===(s=this._currentShape)||void 0===s?void 0:s.props.points)||[],W=(null===(l=null==M?void 0:M.props)||void 0===l?void 0:l.points)||[];if(A[0]!==k[k.length-1][0]||A[1]!==k[k.length-1][1]){k.push(h([],a(A))),W.push([A[0],A[1]]);var U={points:k};null===(d=this._currentShape)||void 0===d||d.attr("props",U),this._renderTemporaryCanvas(),M.props={points:W},B.data=M,this._needUpdateShapeData=B}}else if(this._toolType===t.BoardToolType.LINE){U=o(o({},null===(p=this._currentShape)||void 0===p?void 0:p.props),{x1:A[0],y1:A[1]});M.props=U,null===(u=this._currentShape)||void 0===u||u.attr("props",U),this._renderTemporaryCanvas(),B.data=M,this._needUpdateShapeData=B}else if(this._toolType===t.BoardToolType.ARROW){k=h(h([],a(this._startPosition)),a(A));var G=P(k,2.5*this._brushThin);U=o(o({},null===(_=this._currentShape)||void 0===_?void 0:_.props),{points:G});M.props=U,null===(f=this._currentShape)||void 0===f||f.attr("props",U),this._renderTemporaryCanvas(),B.data=M,this._needUpdateShapeData=B}else if(this._toolType===t.BoardToolType.ELLIPSE){var H=function(t){var e=a(t,4),i=e[0],o=e[1],n=e[2],r=e[3],s=Math.abs(n-i)/2,h=Math.abs(r-o)/2;return[i<n?i+s:n+s,o<r?o+h:r+h,s,h]}(k=h(h([],a(this._startPosition)),a(A)));U=o(o({},null===(v=this._currentShape)||void 0===v?void 0:v.props),{cx:L(H[0],1),cy:L(H[1],1),xr:L(H[2],1),yr:L(H[3],1)});M.props=U,null===(E=this._currentShape)||void 0===E||E.attr("props",U),this._renderTemporaryCanvas(),B.data=M,this._needUpdateShapeData=B}else if(this._toolType===t.BoardToolType.RECT){U=o(o({},null===(y=this._currentShape)||void 0===y?void 0:y.props),{x2:A[0],y2:A[1]});M.props=U,null===(g=this._currentShape)||void 0===g||g.attr("props",U),this._renderTemporaryCanvas(),B.data=M,this._needUpdateShapeData=B}}}},n.prototype.handleMouseUp=function(e){var i=this;if(this._enabled&&this._toolType!==t.BoardToolType.NONE){var o=0,n=0;if(e instanceof MouseEvent)o=e.offsetX,n=e.offsetY;else if(e instanceof TouchEvent){var r=this._canvas.getBoundingClientRect();o=e.changedTouches[0].clientX-r.left,n=e.changedTouches[0].clientY-r.top}var s=L(Math.floor(o),1),a=L(Math.floor(n),1);if(this._endPosition=[s,a],this._toolType!==t.BoardToolType.LASER_POINTER){if(this._toolType===t.BoardToolType.SELECT&&this._selectShape){if(Math.abs(this._endPosition[0]-this._startPosition[0])<=1&&Math.abs(this._endPosition[1]-this._startPosition[1])<=1){var h=[];if(this._displayList.forEach((function(t){t.type===l.TEXT?t.isPointInPath(o,n)&&(h=[t]):i._isPointInShape(o,n,t)&&(h=[t])})),h.length>0){this._selectShapes=[h[0].id];var d=(v=h[0].getBoundingRect()).x,p=v.y,u=v.x+v.width,_=v.y+v.height;this.setControlBoxSize([d,p,u,_]),this.showControlWrap()}}else this.clearPainter(),this._selectShapes.length>0&&(this.showControlWrap(),this.setControlBoxSize(this._controlBoxPosition));this._selectShape=null}else if(this._toolType!==t.BoardToolType.ERASER&&this._toolType!==t.BoardToolType.TEXT&&(this._currentShape&&e instanceof MouseEvent&&"mouseup"===e.type&&0===e.button||e instanceof MouseEvent&&"mouseout"===e.type||e instanceof TouchEvent&&"touchend"===e.type)){if(this._toolType===t.BoardToolType.SELECT)if(Math.abs(this._endPosition[0]-this._startPosition[0])<=1&&Math.abs(this._endPosition[1]-this._startPosition[1])<=1){var f=[];if(this._displayList.forEach((function(t){t.type===l.TEXT?t.isPointInPath(o,n)&&(f=[t]):i._isPointInShape(o,n,t)&&(f=[t])})),f.length>0){this._selectShapes=[f[0].id];var v;d=(v=f[0].getBoundingRect()).x,p=v.y,u=v.x+v.width,_=v.y+v.height;this.setControlBoxSize([d,p,u,_]),this.showControlWrap()}}else this.clearPainter(),this._selectShapes.length>0&&(this.showControlWrap(),this.setControlBoxSize(this._controlBoxPosition));else this._currentShape&&(this._toolType===t.BoardToolType.FREE_DRAW?this._currentShape.props.points.length>1?(this._canUndoList.push({type:c.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null):this.removeElement(this._currentShape.id):(this._canUndoList.push({type:c.ADD_SHAPE,shapes:[this._currentShape]}),this.emit("reportContent",this._needUpdateShapeData),this._needUpdateShapeData=null),this._displayList.set(this._currentShape.id,this._currentShape),this.drawToCachePainter(this._currentShape),this._temporaryList.delete(this._currentShape.id),this._renderTemporaryCanvas());this._currentShape=null}}else(e instanceof TouchEvent&&"touchend"===e.type||e instanceof MouseEvent&&"mouseout"===e.type)&&(this._laserPointer.dispose(),this._latestMovePosition=[],this._needUpdateShapeData=null,this.emit("reportContent",{action:c.DELETE_SHAPE,data:{pIds:[this._laserPointer.id]}}))}},n.prototype.handleControlBoxMouseDown=function(t){if(t instanceof TouchEvent&&"touchstart"===t.type||t instanceof MouseEvent&&"mousedown"===t.type){var e=0,i=0;t instanceof MouseEvent?(e=t.pageX,i=t.pageY):t instanceof TouchEvent&&(e=t.touches[0].pageX,i=t.touches[0].pageY),t.target===this._controlBox?(this.selectStartPosition.length<=0&&(this.selectStartPosition=[e,i],this.selectLatestMovePosition=[e,i]),t.stopPropagation(),t.preventDefault()):t.target===this._controlWrap&&this._selectShapes.length>0&&(this.hideControlWrap(),this._selectShapes=[])}},n.prototype.handleControlBoxMouseMove=function(t){var e=this,i=0,o=0;if(t instanceof MouseEvent?(i=t.pageX,o=t.pageY):t instanceof TouchEvent&&(i=t.touches[0].pageX,o=t.touches[0].pageY),(t instanceof TouchEvent&&"touchmove"===t.type||t instanceof MouseEvent&&"mousemove"===t.type&&t.buttons%2!=0)&&this.selectStartPosition.length>0){var n=i-this.selectLatestMovePosition[0],r=o-this.selectLatestMovePosition[1];e._controlBoxPosition[0]+=n,e._controlBoxPosition[1]+=r,e._controlBoxPosition[2]+=n,e._controlBoxPosition[3]+=r,e._controlBox.style.pointerEvents="none",e.setControlBoxPosition(e._controlBoxPosition),this.moveElement(e._selectShapes,[n,r]),this.selectLatestMovePosition=[i,o]}},n.prototype.handleControlBoxMouseUp=function(t){var e=this;if((t instanceof TouchEvent||"mouseup"===t.type||t instanceof MouseEvent&&"mouseout"===t.type&&t.target===this._controlWrap&&t.buttons%2!=0)&&this.selectStartPosition.length>0){if(Math.abs(this.selectLatestMovePosition[0]-this.selectStartPosition[0])<=1&&Math.abs(this.selectLatestMovePosition[1]-this.selectStartPosition[1])<=1);else{var i=this.selectLatestMovePosition[0]-this.selectStartPosition[0],o=this.selectLatestMovePosition[1]-this.selectStartPosition[1],n={bId:this.id,action:c.MOVE_SHAPE,data:{pIds:this._selectShapes,offset:[i/this.width,o/this.height]}},r=this._selectShapes.map((function(t){return e._displayList.get(t)}));this._canUndoList.push({type:c.MOVE_SHAPE,shapes:r,offset:[i/this.width,o/this.height]}),this.emit("reportContent",n)}this.selectStartPosition=[],this.selectLatestMovePosition=[],this._controlBox.style.pointerEvents="all"}},n.prototype.clearPainter=function(){this._canvasCtx.clearRect(0,0,this.width,this.height)},n.prototype.clearCachePainter=function(){this._cacheCanvasCtx.clearRect(0,0,this.width,this.height)},n.prototype.clearText=function(){this._textBox.innerHTML=""},n.prototype.drawCacheToMain=function(){this._canvasCtx.drawImage(this._cacheCanvas,0,0)},n.prototype._renderTemporaryCanvas=function(){var t=this;this.clearPainter(),this._temporaryList.forEach((function(e){t._drawToPainter(e)}))},n.prototype._drawToPainter=function(t){t.buildPath(this._canvasCtx,t)},n.prototype.drawToCachePainter=function(t){t.buildPath(this._cacheCanvasCtx,t)},n.prototype._handleShapeAttr=function(t,e){var i=this;return this._createProxySetHandle(t,(function(t,o,n,r){e&&e(t,o,n,r),"props"!==o&&"style"!==o||(t[o]=n,i.clearPainter(),i.drawCacheToMain(),t instanceof I?t.setPosition(t.position[0],t.position[1]):i._drawToPainter(t))}))},n.prototype._createProxySetHandle=function(t,e){return new Proxy(t,{set:function(t,i,o,n){return e(t,i,o,n),Reflect.set(t,i,o,n)}})},n.prototype._setBrushCursor=function(e){this._toolType=e;var i="";switch(e){case t.BoardToolType.SELECT:case t.BoardToolType.ARROW:case t.BoardToolType.LINE:case t.BoardToolType.RECT:case t.BoardToolType.ELLIPSE:i="crosshair";break;case t.BoardToolType.FREE_DRAW:var o=decodeURIComponent(G);i='url("data:image/svg+xml;base64,'+btoa(o.split("data:image/svg+xml,")[1])+'") 0 36, crosshair';break;case t.BoardToolType.ERASER:var n=decodeURIComponent(H);i='url("data:image/svg+xml;base64,'+btoa(n.split("data:image/svg+xml,")[1])+'") 3 36, crosshair';break;case t.BoardToolType.TEXT:i="text";break;case t.BoardToolType.LASER_POINTER:i="none";break;default:i="default"}this._canvas.style.cursor=i},n.prototype._isPointInShape=function(t,e,i){var o=A({kind:"canvas",props:{width:this.width,height:this.height},style:{}}).el.getContext("2d");return i.buildPath(o,i),0!==o.getImageData(t,e,1,1).data[3]},n.prototype._eraserShape=function(t,e){var i,o=this;if(this._displayList.forEach((function(n){n instanceof O?n.isPointInPath(t,e)&&(i=n):o._isPointInShape(t,e,n)&&(i=n)})),i){this._displayList.delete(i.id);var n={bId:this.id,action:c.DELETE_SHAPE,data:{pIds:[i.id]}};this.emit("reportContent",n),this._canUndoList.push({type:c.DELETE_SHAPE,shapes:[i]}),this.clearCachePainter(),this._displayList.forEach((function(t){t.buildPath(o._cacheCanvasCtx,{props:t.props,position:t.position,style:t.style})})),requestAnimationFrame((function(){o.clearPainter(),o.drawCacheToMain()}))}},n.prototype._addInputElement=function(t,e,i){var n=(this.boxWidth-this.width)/2,r=(this.boxHeight-this.height)/2,s=A({kind:"textarea",props:o({},v.TEXT_INPUT_ELEMENT_OPTIONS.props),style:o(o({},v.TEXT_INPUT_ELEMENT_OPTIONS.style),{top:i+r+"px",left:e+n+"px","max-width":this.boxWidth-e+"px","max-height":this.boxHeight-i+"px","white-space":"pre-wrap","box-sizing":"content-box",outline:"none",resize:"none","word-break":"break-all",color:this._textColor,"font-size":this._textSize+"px","line-height":this._textSize+"px","min-width":this._textSize+"px","min-height":this._textSize+"px"})}).el;return this.createTextInput(s),s},n.prototype._createTextInputAndHandleChange=function(t,e){var i=this,o={},n=this.brushId,r=this._addInputElement(n,t,e);this._textInput=r;var s=this.boxWidth-t;r.onfocus=function(t){t.target.style.border="1px dashed rgba(167, 156, 156,1)"},r.focus(),requestAnimationFrame((function(){return r.focus()})),r.oninput=function(t){var e=t.target.value,o=B(e,{fontSize:i._textSize,lineHeight:i._textSize,fontFamily:"customFontFamily, sans-serif, serif, monospace"},s),n=o.width,r=o.height;o.list,t.target.style.width=n+2+"px",t.target.style.height=r+2+"px"},r.onblur=function(n){var s=r.value;if(s){o={text:s,fontSize:i._textSize,lineHeight:i._textSize,x:t,y:e,maxWidth:i.boxWidth-t,maxHeight:i.boxHeight-e};var a=new O(i.brushId,{props:o,style:{textFill:i._textColor}});i.drawToCachePainter(a);var h=i._handleShapeAttr(a);i._displayList.set(a.id,h),i._canUndoList.push({type:c.ADD_SHAPE,shapes:[a]});var l={bId:i.id,action:c.ADD_SHAPE,data:{pId:a.id,width:i.width,height:i.height,shape:a.type,props:a.props,style:a.style,position:a.position,lts:Date.now()}};i.emit("reportContent",l)}r.remove(),i._textInput=null}},n}(K),X=function(t){function e(e){var i=t.call(this)||this;if(i._websocket=null,i._url="",i._wss=!0,i._port=443,i.onclose=function(){},i.onerror=function(){},i.onmessage=function(){},e&&"[object Object]"===Object.prototype.toString.call(e)){var o=e.url,n=e.wss,r=e.port;o&&(i._url=o),"boolean"==typeof n&&(i._wss=n),r&&(i._port=r)}return i}return i(e,t),Object.defineProperty(e.prototype,"connectState",{get:function(){return this._websocket?this._websocket.readyState:WebSocket.CLOSED},enumerable:!1,configurable:!0}),e.prototype.open=function(t){var e=this;return new Promise((function(i,o){if(t&&"[object Object]"===Object.prototype.toString.call(t)){var n=t.url,r=t.wss,s=t.port;n&&(e._url=n),"boolean"==typeof r&&(e._wss=r),s&&(e._port=s)}var a=(e._wss?"wss":"ws")+"://"+e._url+":"+e._port;k.debug("[ws-client] websocket opened: "+a),e._websocket=new WebSocket(a),e._websocket.onopen=function(){k.debug("Signaling channel opened. "+a),e._websocket.onerror=function(t){k.debug("Signaling channel error."),e.onerror(t)},e._websocket.onclose=function(t){k.debug("Channel closed with code: "+t.code+" reason: "+t.reason),e._websocket=null,e.onclose(t)},i()},e._websocket.onmessage=function(t){e.onmessage(t)},e._websocket.onerror=function(t){o(Error("WebSocket error."))}}))},e.prototype.close=function(){this._websocket&&(this._websocket.close(),this._websocket=null)},e.prototype.send=function(t){"object"==typeof t?this._websocket&&1===this._websocket.readyState&&this._websocket.send(JSON.stringify(t)):k.error("signal channel msg must be object.")},e.prototype.addMessageEventListener=function(t,e){if(this._websocket)return this._websocket.addEventListener("message",t,e)},e.prototype.removeMessageEventListener=function(t,e){if(this._websocket)return this._websocket.removeEventListener("message",t,e)},e.prototype.clear=function(){this.close(),this.onerror=function(){},this.onclose=function(){},this.onmessage=function(){},this.addMessageEventListener=function(){},this.removeMessageEventListener=function(){}},e}(U),q=function(t){return t.then((function(t){return[null,t]})).catch((function(t){return[t]}))},J=function(t){function e(e){var i=t.call(this)||this;i._cmdEncrypt=!1,i._appId="",i._serverIsWss=!0,i._serverUrl="",i._serverPort=0,i._userId=null,i._connectTimeout=0,i._keepAliveTimeout=0,i._keepALiveInterval=0,i._keepALiveIntervalTime=1e4,i._revState="DISCONNECTED",i._curState="DISCONNECTED",i.handleMediaServerEvents=function(){};var o=i;return e&&e.appId&&(o._appId=e.appId),i}return i(e,t),e.prototype.init=function(t){var e=this,i=t.appId,o=t.isWss,n=t.url,r=t.port;e._appId=i,"boolean"==typeof o&&(e._serverIsWss=o),n&&(e._serverUrl=n),r&&(e._serverPort=r)},e.prototype.setAppInfo=function(t){var e=t.appId;this._appId=e},e.prototype.configServer=function(t,e,i){var o=this;o._serverIsWss=t,o._serverUrl=e,o._serverPort=i},e.prototype.connectServer=function(){var t=this,e=this;return new Promise((function(i,o){return n(t,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return e._emitConnectionState("CONNECTING"),e._setConnectTimeout(),[4,q(e.open({url:e._serverUrl,wss:e._serverIsWss,port:e._serverPort}))];case 1:return t=a.apply(void 0,[r.sent(),2]),(n=t[0])?(e._clearConnectTimeout(),o(n)):(e._clearConnectTimeout(),e._emitConnectionState("CONNECTED"),e.onmessage=function(t){var i=t.data,o=JSON.parse(i),n=o.Cmd;o.Encrypt;var r=o.Content,s=JSON.parse(r);switch(n){case"KeepAlive":e._clearKeepALiveTimeout();break;case"Login":e._startKeepAlive();break;default:e.handleMediaServerEvents&&e.handleMediaServerEvents(n,s)}},e.onerror=function(t){k.error("rtm server handle some error ",t)},e.onclose=function(t){var i=t.code,o=t.reason;switch(k.info("rtm serve disconnected...",i),e._clearConnectTimeout(),e._stopKeepAlive(),e._clearKeepALiveTimeout(),i){case 1e3:case 1005:e._emitConnectionState("DISCONNECTED","LEAVE");break;case 3001:e._emitConnectionState("RECONNECTING","NETWORK_ERROR");break;default:k.debug("media ws serve disconnected with code "+i+", reason "+o),"RECONNECTING"!==e._curState&&e._emitConnectionState("RECONNECTING","SERVER_ERROR")}e.clear()},i()),[2]}}))}))}))},e.prototype.doKeepAlive=function(){var t=this,e={Cmd:"KeepAlive"};e.Encrypt=this._cmdEncrypt,e.Content=JSON.stringify({time:Date.now().toString()}),this.send(e),!t._keepAliveTimeout&&(t._keepAliveTimeout=setTimeout((function(){t._stopKeepAlive(),t._clearKeepALiveTimeout(),t.clear(),t._emitConnectionState("RECONNECTING","KEEP_A_LIVE_TIME_OUT")}),2*t._keepALiveIntervalTime))},e.prototype.doOnline=function(t){var e=this;return new Promise((function(i,o){var n=function(t){var r=t.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var h=s.Content,l=JSON.parse(h);if("Login"===a){e.removeMessageEventListener(n);var c=l.Code;if(0===c){var d=l.UserId;e._userId=d,i(d)}else k.error("user online failure, code => ",c),o(c)}};e.addMessageEventListener(n);var r={Cmd:"Login"};r.AppId=e._appId,r.Encrypt=e._cmdEncrypt,r.Content=JSON.stringify(Object.assign({},t)),e.send(r)}))},e.prototype.doOffline=function(){var t=this;return new Promise((function(e,i){var o=function(n){var r=n.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var h=s.Content,l=JSON.parse(h);if("Logout"===a){t.removeMessageEventListener(o);var c=l.Code;0===c?e(c):i(c)}};t.addMessageEventListener(o);var n={Cmd:"Logout"};n.Encrypt=t._cmdEncrypt,n.Content="",t.send(n)}))},e.prototype.doJoinChannel=function(t){var e=this;return new Promise((function(i,o){var n=function(t){var r=t.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var h=s.Content,l=JSON.parse(h);if("JoinChannel"===a){e.removeMessageEventListener(n);var c=l.Code;l.ChanId,0===c?i():o(c)}};e.addMessageEventListener(n);var r={Cmd:"JoinChannel"};r.Encrypt=e._cmdEncrypt,r.Content=JSON.stringify(Object.assign({ChanId:t})),e.send(r)}))},e.prototype.doSendChannelMsg=function(t,e,i,o){void 0===o&&(o=!1);var n=this;return new Promise((function(r,s){var a=function(t){var e=t.data,i=JSON.parse(e),o=i.Cmd;i.Encrypt;var h=i.Content,l=JSON.parse(h);if("SendChannelMsg"===o){n.removeMessageEventListener(a);var c=l.Code;l.ChanId,l.MsgId,0===c?r():s(c)}};n.addMessageEventListener(a);var h={Cmd:"SendChannelMsg"};h.Encrypt=n._cmdEncrypt,h.Content=JSON.stringify(Object.assign({ChanId:e,FromUId:n._userId,MsgId:Date.now(),MsgType:t,MsgBody:i,HistoryMsg:o,Desc:""})),n.send(h)}))},e.prototype.disconnectServer=function(t){var e=this;if(e._stopKeepAlive(),e._clearKeepALiveTimeout(),e.clear(),t)switch(t){case"UID_BANNED":e._emitConnectionState("DISCONNECTED","UID_BANNED");break;case"TOKEN_INVALID":e._emitConnectionState("DISCONNECTED","TOKEN_INVALID")}else e._emitConnectionState("DISCONNECTED","LEAVE")},e.prototype.clearEventEmitter=function(){this.removeAllListeners()},e.prototype._setConnectTimeout=function(){this._clearConnectTimeout()},e.prototype._startKeepAlive=function(){var t=this;t._stopKeepAlive(),t.doKeepAlive(),t._keepALiveInterval=setInterval((function(){t.doKeepAlive()}),t._keepALiveIntervalTime)},e.prototype._stopKeepAlive=function(){this._keepALiveInterval&&clearInterval(this._keepALiveInterval)},e.prototype._clearConnectTimeout=function(){this._connectTimeout&&clearTimeout(this._connectTimeout)},e.prototype._clearKeepALiveTimeout=function(){var t=this;t._keepAliveTimeout&&(clearTimeout(t._keepAliveTimeout),t._keepAliveTimeout=0)},e.prototype._emitConnectionState=function(t,e){"DISCONNECTED"===t&&k.debug("[signal] mNode websocket closed, reason: "+e),this._revState=this._curState,this._curState=t,this.handleMediaServerEvents&&this.handleMediaServerEvents("connection-state-change",{curState:this._curState,revState:this._revState,reason:e})},e}(X),Z=function(t){function e(e){var i=t.call(this)||this;i._cmdEncrypt=!1,i._appId="",i._serverIsWss=!0,i._serverUrl="",i._serverPort=0,i._channel=null,i._userId=null,i._connectTimeout=0,i._keepAliveTimeout=0,i._keepALiveInterval=0,i._keepALiveIntervalTime=1e4,i._revState="DISCONNECTED",i._curState="DISCONNECTED",i.handleMediaServerEvents=function(){};var o=i;return e&&e.appId&&(o._appId=e.appId),i}return i(e,t),e.prototype.send=function(e){t.prototype.send.call(this,e)},e.prototype.init=function(t){var e=this,i=t.appId,o=t.isWss,n=t.url,r=t.port;e._appId=i,"boolean"==typeof o&&(e._serverIsWss=o),n&&(e._serverUrl=n),r&&(e._serverPort=r)},e.prototype.setAppInfo=function(t){var e=t.appId;this._appId=e},e.prototype.configServer=function(t,e,i){var o=this;o._serverIsWss=t,o._serverUrl=e,o._serverPort=i},e.prototype.connectServer=function(t,e,i){var o=this,s=this;return new Promise((function(h,l){return n(o,void 0,void 0,(function(){var o,n,c,d;return r(this,(function(r){switch(r.label){case 0:return s._emitConnectionState("CONNECTING"),s._setConnectTimeout(),[4,q(s.open({url:s._serverUrl,wss:s._serverIsWss,port:s._serverPort}))];case 1:return o=a.apply(void 0,[r.sent(),2]),(n=o[0])?(s._clearConnectTimeout(),l(n),[3,4]):[3,2];case 2:return s._clearConnectTimeout(),s._emitConnectionState("CONNECTED"),this._channel=t,this._userId=e,[4,q(this.doInit({appId:s._appId,chanId:t,uId:e,accessToken:i}))];case 3:if(c=a.apply(void 0,[r.sent(),2]),d=c[0])return s._clearConnectTimeout(),l(d),[2];h(),s.onmessage=function(t){var e=t.data,i=JSON.parse(e),o=i.cmd,n=i.data;if(i.errMsg,i.errCode,"CONNECT"===o);else s.handleMediaServerEvents&&s.handleMediaServerEvents(o,n)},s.onerror=function(t){k.error("board server handle some error ",t)},s.onclose=function(t){var e=t.code,i=t.reason;switch(k.info("board serve disconnected...",e),s._clearConnectTimeout(),s._clearKeepALiveTimeout(),e){case 1e3:case 1005:s._emitConnectionState("DISCONNECTED","LEAVE");break;case 3001:s._emitConnectionState("RECONNECTING","NETWORK_ERROR");break;default:k.debug("media ws serve disconnected with code "+e+", reason "+i),"RECONNECTING"!==s._curState&&s._emitConnectionState("RECONNECTING","SERVER_ERROR")}s.clear()},h(),r.label=4;case 4:return[2]}}))}))}))},e.prototype.doInit=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.INIT&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("BOARD_SERVER_INIT_FAILED"),o("BOARD_SERVER_INIT_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.INIT,seqId:n,data:t,rts:n};e.send(s)}))},e.prototype.doGetChannelInfo=function(){var t=this;return new Promise((function(e,i){var o=""+Date.now(),n=function(i){var r=i.data,s=JSON.parse(r),a=s.cmd;s.data,s.errMsg,s.errCode;var h=s.seqId;a===c.CHAN_DATA&&o===h&&(t.removeMessageEventListener(n),e())};t.addMessageEventListener(n);var r={cmd:c.CHAN_DATA,seqId:o,rts:o};t.send(r)}))},e.prototype.doAddFile=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.ADD_FILE&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("ADD_FILE_FAILED"),o("ADD_FILE_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.ADD_FILE,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doAddBoard=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.ADD_BOARD&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("ADD_BOARD_FAILED"),o("ADD_BOARD_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.ADD_BOARD,seqId:n,data:t,rts:n};e.send(s)}))},e.prototype.doDeleteBoard=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.DELETE_BOARD&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("DELETE_BOARD_FAILED"),o("DELETE_BOARD_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.DELETE_BOARD,seqId:n,data:t,rts:n};e.send(s)}))},e.prototype.doSwitchBoard=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.SWITCH_BOARD&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("SWITCH_BOARD_FAILED"),o("SWITCH_BOARD_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.SWITCH_BOARD,seqId:n,data:t,rts:n};e.send(s)}))},e.prototype.doResetBoard=function(){var t=this;return new Promise((function(e,i){var o=""+Date.now(),n=function(r){var s=r.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.RESET_BOARD&&o===d&&(t.removeMessageEventListener(n),0===l?e():(k.warning("RESET_BOARD_FAILED"),i("RESET_BOARD_FAILED")))};t.addMessageEventListener(n);var r={cmd:c.RESET_BOARD,seqId:o,rts:o};t.send(r)}))},e.prototype.doClearBoard=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.CLEAR_BOARD&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("CLEAR_BOARD_FAILED"),o("CLEAR_BOARD_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.CLEAR_BOARD,seqId:n,data:t,rts:n};e.send(s)}))},e.prototype.doSetBoardRatio=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.BOARD_RATIO&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("BOARD_RATIO_FAILED"),o("BOARD_RATIO_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.BOARD_RATIO,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doScaleBoard=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.SCALE_BOARD&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("SCALE_BOARD_FAILED"),o("SCALE_BOARD_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.SCALE_BOARD,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doUpdateBoardBackgroundColor=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.UPDATE_BACKGROUND&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("UPDATE_BACKGROUND_FAILED"),o("UPDATE_BACKGROUND_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.UPDATE_BACKGROUND,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doUpdateBoardBackgroundImage=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var s=t.data,a=JSON.parse(s),h=a.cmd;a.data,a.errMsg;var l=a.errCode,d=a.seqId;h===c.UPDATE_BACKGROUND_IMAGE&&n===d&&(e.removeMessageEventListener(r),0===l?i():(k.warning("UPDATE_BACKGROUND_IMAGE_FAILED"),o("UPDATE_BACKGROUND_IMAGE_FAILED")))};e.addMessageEventListener(r);var s={cmd:c.UPDATE_BACKGROUND_IMAGE,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doAddShape=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var o=t.data,s=JSON.parse(o),a=s.cmd;s.data,s.errMsg,s.errCode;var h=s.seqId;a===c.ADD_SHAPE&&n===h&&(e.removeMessageEventListener(r),i())};e.addMessageEventListener(r);var s={cmd:c.ADD_SHAPE,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doMoveShape=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var i=t.data,o=JSON.parse(i),n=o.cmd;o.data,o.errMsg,o.errCode,o.seqId,n===c.MOVE_SHAPE&&e.removeMessageEventListener(r)};e.addMessageEventListener(r);var s={cmd:c.MOVE_SHAPE,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.doDeleteShape=function(t){var e=this;return new Promise((function(i,o){var n=""+Date.now(),r=function(t){var o=t.data,s=JSON.parse(o),a=s.cmd;s.data,s.errMsg,s.errCode;var h=s.seqId;a===c.DELETE_SHAPE&&n===h&&(e.removeMessageEventListener(r),i())};e.addMessageEventListener(r);var s={cmd:c.DELETE_SHAPE,seqId:n,rts:n,data:t};e.send(s)}))},e.prototype.disconnectServer=function(t){var e=this;if(e._clearKeepALiveTimeout(),e.clear(),t)switch(t){case"UID_BANNED":e._emitConnectionState("DISCONNECTED","UID_BANNED");break;case"TOKEN_INVALID":e._emitConnectionState("DISCONNECTED","TOKEN_INVALID")}else e._emitConnectionState("DISCONNECTED","LEAVE")},e.prototype.clearEventEmitter=function(){this.removeAllListeners()},e.prototype._setConnectTimeout=function(){this._clearConnectTimeout()},e.prototype._clearConnectTimeout=function(){this._connectTimeout&&clearTimeout(this._connectTimeout)},e.prototype._clearKeepALiveTimeout=function(){var t=this;t._keepAliveTimeout&&(clearTimeout(t._keepAliveTimeout),t._keepAliveTimeout=0)},e.prototype._emitConnectionState=function(t,e){"DISCONNECTED"===t&&k.debug("[signal] bNode websocket closed, reason: "+e),this._revState=this._curState,this._curState=t,this.handleMediaServerEvents&&this.handleMediaServerEvents("connection-state-change",{curState:this._curState,revState:this._revState,reason:e})},e}(X),Q=function(){function t(t){if(this._url="",this._wss=!0,this._port=443,this._timeout=6e4,"[object Object]"===Object.prototype.toString.call(t)){var e=t.url,i=t.wss,o=t.port,n=t.timeout;"string"==typeof e&&(this._url=e),"boolean"==typeof i&&(this._wss=i,this._port=i?443:80),"number"==typeof o&&(this._port=o),"number"==typeof n&&(this._timeout=n)}}return t.prototype.setRequestUrl=function(t){if("[object Object]"===Object.prototype.toString.call(t)){var e=t.url,i=t.wss,o=t.port;"string"==typeof e&&(this._url=e),"boolean"==typeof i&&(this._wss=i,this._port=i?443:80),"number"==typeof o&&(this._port=o)}},t.prototype.request=function(t,e,i){return this._sendUrlRequest(t,e,i)},t.prototype.post=function(t,e){return this.request(t,"POST",e)},t.prototype.get=function(t,e){return this.request(t,"GET",e)},t.prototype._sendUrlRequest=function(t,e,i,o){var n=this;return void 0===o&&(o=!0),new Promise((function(r,s){if(""!==n._url){var a=n._url;t&&(a=n._url+t);var h=new XMLHttpRequest;h.timeout=6e4;var l=function(){200===h.status?r(JSON.parse(h.responseText)):s(new Y(y.NETWORK_RESPONSE_ERROR))};o&&(h.onreadystatechange=function(t){4===h.readyState&&l()}),h.open(e,a,o),h.onerror=function(t){s(new Y(y.NETWORK_ERROR))},h.ontimeout=function(){s(new Y(y.NETWORK_TIMEOUT))},h.send(JSON.stringify(i)),o||l()}else s("NO_REQUEST_URL")}))},t}(),$=function(){function t(){this._urls=[],this._urlSuffix="/arapi/v1?action=",this._appid="",this._sessionId="",this._urls=[v.GATEWAY_ADDRESS],this._urlSuffix="/arapi/v1?action="}return t.prototype.joinGateway=function(t){var e=this;void 0===t&&(t={});var i=this;return new Promise((function(s,a){var h=i._urlSuffix.concat("wb_gateway"),l=function(){return n(e,void 0,void 0,(function(){var e,n,c,d,p,u;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.race(this._urls.map((function(e){return new Q({url:e,timeout:v.GATEWAY_CONNECT_TIMEOUT}).post(h,o({},t))})))];case 1:if(e=r.sent())if(0===(n=e.code))c=e.sessionid,d=t.appId,i._sessionId=c,i._appid=d,s(e);else if(-1===n)setTimeout((function(){l()}),v.GATEWAY_CONNECT_TIMEOUT);else{if(-4===n||-7===n)throw new Y(E.MISSING_PARAMETER,"MISSING_PARAMETER");if(13===n)throw new Y(E.DEVELOPER_INVALID,"DEVELOPER_INVALID");if(14===n)throw new Y(E.UID_BANNED,"UID_BANNED");if(15===n)throw new Y(E.IP_BANNED,"IP_BANNED");if(16===n)throw new Y(E.CHANNEL_BANNED,"CHANNEL_BANNED");if(101===n)throw new Y(E.APPID_INVALID,"APPID_INVALID");if(102===n)throw new Y(E.SERVER_NOT_OPEN,"SERVER_NOT_OPEN");if(109===n)throw new Y(E.TOKEN_EXPIRED,"TOKEN_EXPIRED You must request a new token from your server and call join to use the new token to join the channel");if(110===n)throw new Y(E.TOKEN_INVALID,"TOKEN_INVALID make sure token is right and try angain please");setTimeout((function(){l()}),v.GATEWAY_CONNECT_TIMEOUT)}return[3,3];case 2:return p=r.sent(),"NETWORK_ERROR"===(u=p).code||"NETWORK_TIMEOUT"===u.code||"NETWORK_RESPONSE_ERROR"===u.code?(setTimeout((function(){l()}),v.GATEWAY_CONNECT_TIMEOUT),[2]):(a(u),[3,3]);case 3:return[2]}}))}))};l()}))},t}(),tt=function(){this.type=0,this.fId="#DEFAULT",this.url="",this.title="DEFAULT",this.currentPageIndex=1,this.totalPageCount=1,this.boardList=[],this.width=1920,this.height=1080},et=function(){this.bId="",this.scale=100,this.ratio="16:9",this.color="#ffffff",this.image="",this.url="",this.pList=new Map,this.canUndoList=[],this.canRedoList=[]};t.BoardConnectionState=void 0,function(t){t[t.DISCONNECTED=1]="DISCONNECTED",t[t.CONNECTING=2]="CONNECTING",t[t.RECONNECTING=3]="RECONNECTING",t[t.CONNECTED=4]="CONNECTED",t[t.DISCONNECTING=5]="DISCONNECTING"}(t.BoardConnectionState||(t.BoardConnectionState={}));var it=function(e){function p(i){var n=e.call(this)||this;n.uid="",n._authState=t.BoardConnectionState.DISCONNECTED,n._appid="",n._channel="",n._rtmSignal=void 0,n._boardSignal=void 0,n._fileId="#DEFAULT",n._fileList=new Map,n._boardId="",n._fileBoardData=new Map,n._curMaxBoardPage=1,n._renderFrameRate=5,n._initConfig={};var r={baseParams:o({scale:100},null==i?void 0:i.baseParams),styleParams:o({textSize:16,textColor:"#333333",brushColor:"#333333",brushThin:5,globalBackgroundColor:v.BOARD_BACKGROUND_COLOR,selectBoxColor:v.BOARD_SELECT_STYLE.strokeStyle},null==i?void 0:i.styleParams)},s=r.baseParams,a=r.styleParams;if(s&&"{}"===JSON.stringify(s)){var h=s.scale;h&&"number"!=typeof h&&h<100&&(r.baseParams.scale=100)}return a&&"{}"===JSON.stringify(a)&&n.setBoardStyleParams(a),n._initConfig=r,n}return i(p,e),Object.defineProperty(p.prototype,"_currentBoardPage",{get:function(){var t=this._fileList.get(this._fileId);return t?t.currentPageIndex:1},set:function(t){var e=this._fileList.get(this._fileId);e&&(e.currentPageIndex=t)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"_totalBoardCount",{get:function(){var t=this._fileList.get(this._fileId);return t?t.totalPageCount:1},set:function(t){var e=this._fileList.get(this._fileId);e&&(e.totalPageCount=t)},enumerable:!1,configurable:!0}),p.prototype[d.ADD_BOARD]=function(t,e){},p.prototype[d.DELETE_BOARD]=function(t,e){},p.prototype[d.GOTO_BOARD]=function(t,e){},p.prototype[d.SCALE_BOARD]=function(t,e){},p.prototype[d.CAN_UNDO_STATUS_CHANGE]=function(t){},p.prototype[d.CAN_REDO_STATUS_CHANGE]=function(t){},p.prototype[d.CONNECTION_STATE_CHANGE]=function(t,e){},p.prototype[d.BOARD_BACKGROUND_COLOR_CHANGE]=function(t,e,i){},p.prototype[d.CLEAR_BOARD]=function(t,e){},p.prototype[d.RESET_BOARD]=function(){},p.prototype[d.ERROR]=function(t){},p.prototype[d.WARNING]=function(t){},p.prototype.getVersion=function(){return v.SDK_VERSION},p.prototype.setParameters=function(t){var e=t.ConfPriCloudAddr,i=t.ConfPriCloudAddr1;if(k.debug("set parameters config as "+JSON.stringify(t)),e){var o=e.ServerAdd,n=e.Port,r=!0;"boolean"==typeof(s=e.Wss)&&(r=s),v.GATEWAY_ADDRESS_SSL!==r&&(v.GATEWAY_ADDRESS_SSL=r),v.GATEWAY_ADDRESS1&&(v.GATEWAY_ADDRESS1=""),o&&(v.GATEWAY_ADDRESS=(r?"https://"+o:"http://"+o)+(n?":"+n:""))}if(i){var s;o=i.ServerAdd,n=i.Port,r=!0;"boolean"==typeof(s=i.Wss)&&(r=s),v.GATEWAY_ADDRESS_SSL!==r&&(v.GATEWAY_ADDRESS_SSL=r),o&&(v.GATEWAY_ADDRESS1=(r?"https://"+o:"http://"+o)+(n?":"+n:""))}},p.prototype.setBoardStyleParams=function(t){var e=this._initConfig;e.baseParams;var i=e.styleParams;if(Object.assign(i,t),i&&"{}"===JSON.stringify(i)){var o=i.textSize,n=i.textColor,r=i.brushColor,s=i.brushThin,a=i.selectBoxColor,h=i.globalBackgroundColor;o&&"number"!=typeof o&&(i.textSize=16),"string"!=typeof n&&(i.textColor="#333333"),"string"!=typeof r&&(i.brushColor="#333333"),s&&"number"!=typeof s&&s<5&&(i.brushThin=5),"string"!=typeof a&&(i.selectBoxColor="#eeeeee"),"string"!=typeof h&&(i.globalBackgroundColor="#ffffff")}},p.prototype.setBackgroundColor=function(e){var i=this;if(this._authState===t.BoardConnectionState.CONNECTED){var o=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doUpdateBoardBackgroundColor({bId:this._boardId,color:e}))];case 1:return t=a.apply(void 0,[i.sent(),2]),t[0]?setTimeout((function(){o()}),3e3):this._setBoardBGColor(this._boardId,e),[2]}}))}))};o()}},p.prototype.getBackgroundColor=function(){return this._painter.backgroundColor},p.prototype.setGlobalBackgroundColor=function(e){var i=this;if(this._authState===t.BoardConnectionState.CONNECTED){var o=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doUpdateBoardBackgroundColor({bId:this._boardId,color:e}))];case 1:return t=a.apply(void 0,[i.sent(),2]),t[0]?setTimeout((function(){o()}),3e3):this._setGlobalBoardBGColor(e),[2]}}))}))};o()}},p.prototype.getGlobalBackgroundColor=function(){return this._initConfig.styleParams.globalBackgroundColor||""},p.prototype.setBackgroundImage=function(e){var i=this;if(this._setBoardBGImage(this._boardId,e),this._authState===t.BoardConnectionState.CONNECTED){var o=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doUpdateBoardBackgroundImage({bId:this._boardId,image:e}))];case 1:return t=a.apply(void 0,[i.sent(),2]),t[0]&&setTimeout((function(){o()}),3e3),[2]}}))}))};o()}},p.prototype.getCurrentFileId=function(){return this._fileId},p.prototype.getCurrentBoardId=function(){return this._boardId},p.prototype.getUndoStatus=function(){},p.prototype.getFileInfo=function(t){return this._fileList.get(t)},p.prototype.addBoard=function(){var e=this;if("#DEFAULT"!==this._fileId){var i=new Y(E.INVALID_OPERATION,"This file not allow add a new board.");throw k.error(i),i}var o="web_"+this.uid+"_"+Date.now()+"_"+(this._curMaxBoardPage+1)+"_"+this._fileId;if(k.info("local add board: "+o),this._authState===t.BoardConnectionState.CONNECTED){var s={bId:o,color:this._initConfig.styleParams.globalBackgroundColor,image:"",url:"",scale:100},h=function(){return n(e,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,q(this._boardSignal.doAddBoard(s))];case 1:return t=a.apply(void 0,[e.sent(),2]),t[0]?setTimeout((function(){h()}),3e3):this._addBoard(o),[2]}}))}))};h()}},p.prototype.deleteBoard=function(e){var i=this;if("#DEFAULT"===this._fileId)if(1!==this._currentBoardPage)if(e&&"string"!=typeof e)k.error("Error: boardId must be string.");else{var o=e||this._boardId;k.info("local delete board: "+o);var s=this._fileBoardData.get(o);if(s){var h=s.bId;if(this._authState===t.BoardConnectionState.CONNECTED){var l=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,q(this._boardSignal.doDeleteBoard({bIds:[h]}))];case 1:return t=a.apply(void 0,[e.sent(),1]),t[0]?setTimeout((function(){l()}),3e3):this._deleteBoard([h]),[2]}}))}))};l()}}else k.error("Error: Can not find the board id is "+e+".")}else k.error("Can not delete this page.");else k.error("This file not allow delete board.")},p.prototype.getBoardList=function(){var t=[];return this._fileList.forEach((function(e){t.push.apply(t,h([],a(e.boardList)))})),t},p.prototype.getFileBoardList=function(t){var e=this._fileList.get(t);return e?e.boardList:[]},p.prototype.setBoardScale=function(e){var i=this;if("number"==typeof e&&e>=100&&this._authState===t.BoardConnectionState.CONNECTED){var o=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doScaleBoard({bId:this._boardId,scale:e}))];case 1:return t=a.apply(void 0,[i.sent(),1]),t[0]?setTimeout((function(){o()}),3e3):this._scaleBoard(this._boardId,e),[2]}}))}))};o()}},p.prototype.getBoardScale=function(){var t=this._fileBoardData.get(this._boardId);return(null==t?void 0:t.scale)||100},p.prototype.prevBoard=function(){var e=this;if(1!==this._currentBoardPage&&this._authState===t.BoardConnectionState.CONNECTED){var i=this._currentBoardPage-1,o=this._fileList.get(this._fileId).boardList[i-1],s=function(){return n(e,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,q(this._boardSignal.doSwitchBoard({bId:o}))];case 1:return t=a.apply(void 0,[e.sent(),2]),t[0]?setTimeout((function(){s()}),3e3):(this._gotoBoard(o),k.info("switch to page "+this._currentBoardPage)),[2]}}))}))};s()}},p.prototype.nextBoard=function(){var e=this;if(!(this._currentBoardPage>=this._totalBoardCount)&&this._authState===t.BoardConnectionState.CONNECTED){var i=this._currentBoardPage+1,o=this._fileList.get(this._fileId).boardList[i-1],s=function(){return n(e,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,q(this._boardSignal.doSwitchBoard({bId:o}))];case 1:return t=a.apply(void 0,[e.sent(),2]),t[0]?setTimeout((function(){s()}),3e3):(this._gotoBoard(o),k.info("switch to page "+this._currentBoardPage)),[2]}}))}))};s()}},p.prototype.gotoBoard=function(e){var i=this;if(this._authState===t.BoardConnectionState.CONNECTED){var o=function(){return n(i,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doSwitchBoard({bId:e}))];case 1:return t=a.apply(void 0,[i.sent(),2]),t[0]?setTimeout((function(){o()}),3e3):(this._gotoBoard(e),k.info("switch to page "+this._currentBoardPage)),[2]}}))}))};o()}},p.prototype.reset=function(){if(this._authState!==t.BoardConnectionState.CONNECTED)throw new Error("");this._boardSignal.doResetBoard(),this._resetBoard()},p.prototype.getBoardSnapshot=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getSnapShortImage()},p.prototype.setEnable=function(t){"boolean"==typeof t?this._painter.setEnable(t):k.error(E.INVALID_PARAMS)},p.prototype.getEnable=function(){return this._painter.getEnable()},p.prototype.setBrushColor=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushColor(t)},p.prototype.getBrushColor=function(){return this._painter.brushColor},p.prototype.setBrushType=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushType(t)},p.prototype.getBrushType=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.brushType},p.prototype.setBrushThin=function(t){var e;null===(e=this._painter)||void 0===e||e.setBrushThin(t)},p.prototype.getBrushThin=function(){return this._painter.brushThin},p.prototype.setTextColor=function(t){var e;null===(e=this._painter)||void 0===e||e.setTextColor(t)},p.prototype.getTextColor=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getTextColor()},p.prototype.setTextSize=function(t){var e;null===(e=this._painter)||void 0===e||e.setTextSize(t)},p.prototype.getTextSize=function(){var t;return null===(t=this._painter)||void 0===t?void 0:t.getTextSize()},p.prototype.resize=function(){var t,e=this;null===(t=this._painter)||void 0===t||t.renderSize();var i=this._fileBoardData.get(this._boardId);i&&(this._painter.clear(!0),i.pList.forEach((function(t){e._convertBrushDataAndRenderToBoard(t)})),this._painter.renderControlBox())},p.prototype.clear=function(e){var i,o=this,s=this._fileBoardData.get(this._boardId);if(e&&(this._painter.clearBackground(),s.color=null===(i=this._initConfig.styleParams)||void 0===i?void 0:i.globalBackgroundColor,s.image="",s.url=""),this._painter.clearAll(),s.pList.clear(),this._authState===t.BoardConnectionState.CONNECTED){var h=function(){return n(o,void 0,void 0,(function(){var t;return r(this,(function(i){switch(i.label){case 0:return[4,q(this._boardSignal.doClearBoard({bId:this._boardId,bg:!!e}))];case 1:return t=a.apply(void 0,[i.sent(),2]),t[0]&&setTimeout((function(){h()}),3e3),[2]}}))}))};h()}},p.prototype.undo=function(){var t;this._painter.canUndoList.length>0&&(null===(t=this._painter)||void 0===t||t.undo())},p.prototype.redo=function(){var t;this._painter.canRedoList.length>0&&(null===(t=this._painter)||void 0===t||t.redo())},p.prototype.joinChannel=function(t,e){var i=this,o=e.channel,s=e.appid,a=e.uid;if(!s)throw new Y(E.INVALID_PARAMS);if(this._appid=s,!o)throw new Y(E.INVALID_PARAMS);if(this._channel=o,!a)throw new Y(E.INVALID_PARAMS);return this.uid=a,this._initPainter(t,this._initConfig),n(i,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this._authGateWay()];case 1:return t.sent(),[2]}}))}))},p.prototype.leaveChannel=function(){var e,i;this._authState===t.BoardConnectionState.CONNECTED?(null===(e=this._rtmSignal)||void 0===e||e.disconnectServer(),null===(i=this._boardSignal)||void 0===i||i.disconnectServer(),this._rtmSignal=void 0,this._boardSignal=void 0,this._authState=t.BoardConnectionState.DISCONNECTED,this.emit(d.CONNECTION_STATE_CHANGE,this._authState,""),this._fileList.clear(),this._fileId="",this._initConfig={},this._fileBoardData.clear(),this._channel="",this._appid="",this.uid="",this._boardId="",this._curMaxBoardPage=1,this._painter.setEnable(!1),this._painter.clearAll(),this._painter.destroy(),this.removeAllListeners()):k.error("join channel first please!")},p.prototype.on=function(t,i){e.prototype.on.call(this,t,i)},p.prototype._initPainter=function(e,i){var s=this;if(!this._painter){if(!e)throw new Y(E.INVALID_PARAMS);var a=i.baseParams,h=i.styleParams,l=o(o({ratio:"16:9",scale:100},a),h);this._painter=new j(e,l),this._painter.showLoading(),this._painter.setEnable(!1),this._painter.setBrushType(t.BoardToolType.NONE),setInterval((function(){var t,e,i=s._painter.getNeedUpdateShapeData();if(i)if(i.action===c.ADD_SHAPE){var n=i.data;s._saveToBoardBrushData(i.bId,n),null===(t=s._boardSignal)||void 0===t||t.doAddShape(o(o({},n),{bId:i.bId}))}else if(i.action===c.MOVE_SHAPE){var r=i.data,a=r.pIds,h=r.offset;null===(e=s._boardSignal)||void 0===e||e.doMoveShape(o(o({},i.data),{bId:i.bId}));var l=s._fileBoardData.get(i.bId);l&&l.pList.forEach((function(t){if(a.includes(t.pId)){var e=[t.width*h[0],t.height*h[1]];t.position=e}}))}}),1e3/this._renderFrameRate),this._painter.on("reportContent",(function(t){return n(s,void 0,void 0,(function(){var e,i,n,s,a,h,l,p,u,_,f,v,E;return r(this,(function(r){return t&&(t.action===c.ADD_SHAPE?(e=t.data,null===(u=this._boardSignal)||void 0===u||u.doAddShape(o(o({},e),{bId:t.bId})),this._saveToBoardBrushData(t.bId,e)):t.action===c.DELETE_SHAPE?(null===(_=this._boardSignal)||void 0===_||_.doDeleteShape(o({bId:t.bId},t.data)),i=t.data.pIds,(n=this._fileBoardData.get(t.bId))&&n.pList.forEach((function(t){var e=t.pId;~i.indexOf(e)&&n.pList.delete(e)}))):t.action===c.MOVE_SHAPE&&(s=t.data,a=s.pIds,h=s.offset,null===(f=this._boardSignal)||void 0===f||f.doMoveShape(o(o({},t.data),{bId:t.bId})),(l=this._fileBoardData.get(t.bId))&&l.pList.forEach((function(t){if(a.includes(t.pId)){var e=[t.width*h[0],t.height*h[1]];t.position=[t.position[0]+e[0],t.position[1]+e[1]]}})))),(p=this._fileBoardData.get(t.bId)).canUndoList=this._painter.canUndoList,p.canRedoList=this._painter.canRedoList,this.emit(d.CAN_REDO_STATUS_CHANGE,(null===(v=this._painter)||void 0===v?void 0:v.canRedoList.length)>0),this.emit(d.CAN_UNDO_STATUS_CHANGE,(null===(E=this._painter)||void 0===E?void 0:E.canUndoList.length)>0),[2]}))}))}))}},p.prototype._processChannelInfo=function(t){var e,i,o=this,n=t.fId,r=t.fileList;if(0===r.length){var s=Date.now();this._fileId="#DEFAULT",this._currentBoardPage=1,this._totalBoardCount=1,this._boardId="web_"+this.uid+"_"+s+"_"+this._currentBoardPage+"_"+this._fileId;var a=new tt;a.boardList=[this._boardId],this._boardSignal.doAddFile(a),this._fileList.set(this._fileId,a);var h=new et;h.bId=this._boardId="web_"+this.uid+"_"+s+"_1_"+this._fileId,h.scale=(null===(i=null===(e=this._initConfig)||void 0===e?void 0:e.baseParams)||void 0===i?void 0:i.scale)||100,this._fileBoardData.set(this._boardId,h)}else{this._fileId=n,r.forEach((function(t){var e=t.boardList;t.boardList=[],e.forEach((function(e){t.boardList.push(e.bId),e.pList=new Map;var i=new et;i.bId=e.bId,i.scale=e.scale,i.color=e.color,i.image=e.image,i.url=e.url,o._fileBoardData.set(e.bId,i)})),o._fileList.set(o._fileId,t)}));var l=this._fileList.get(this._fileId),c=l.currentPageIndex,d=l.totalPageCount,p=l.boardList;this._currentBoardPage=c,this._totalBoardCount=d,this._boardId=p[c-1];var u=p[p.length-1].split("_");this._curMaxBoardPage=Number(u[u.length-2])}},p.prototype._processBoardData=function(t){var e=this;t.data.forEach((function(t){k.debug("convert to board ("+t.bId+") data.");var i=e._fileBoardData.get(t.bId);i&&(i.scale=t.scale,i.url=t.url,i.image=t.image,i.color=t.color,t.pList.forEach((function(t){e._saveToBoardBrushData(i.bId,t)})))}))},p.prototype._calculateScaleProps=function(t,e,i,o){var n=this._painter.width/i;if(t===l.FREE_DRAW||t===l.ARROW){var r=e.points.map((function(t){return[t[0]*n,t[1]*n]}));e.points=r}else t===l.CIRCLE||t===l.LASER_POINTER?(e.cx=e.cx*n,e.cy=e.cy*n):t===l.ELLIPSE?(e.cx*=n,e.cy*=n,e.xr*=n,e.yr*=n):t===l.LINE?(e.x*=n,e.y*=n,e.x1*=n,e.y1*=n):t===l.RECT?(e.x1*=n,e.y1*=n,e.x2*=n,e.y2*=n):t===l.TEXT&&(e.x*=n,e.y*=n,e.fontSize*=n,e.lineHeight*=n)},p.prototype._convertBrushDataToCurrentBoardSize=function(t){var e=JSON.parse(JSON.stringify(t)),i=e.width,o=e.shape,n=e.props,r=this._painter.width/i;if(o===l.FREE_DRAW||o===l.ARROW){var s=n.points.map((function(t){return[t[0]*r,t[1]*r]}));n.points=s}else o===l.LASER_POINTER?(n.cx=n.cx*r,n.cy=n.cy*r):o===l.ELLIPSE?(n.cx*=r,n.cy*=r,n.xr*=r,n.yr*=r):o===l.LINE?(n.x*=r,n.y*=r,n.x1*=r,n.y1*=r):o===l.RECT?(n.x1*=r,n.y1*=r,n.x2*=r,n.y2*=r):o===l.TEXT&&(n.x*=r,n.y*=r,n.fontSize*=r,n.lineHeight*=r);return e.width=this._painter.width,e.height=this._painter.height,e.position=[e.position[0]*r,e.position[1]*r],e},p.prototype._saveToBoardBrushData=function(t,e){var i=e.shape,o=e.pId,n=e.props;e.position,e.width,e.height;var r=this._fileBoardData.get(t);if(r){var s=r.pList.get(o);if(s)if(i===l.FREE_DRAW){var a=s.props.points,h=n.points;a.map((function(t){return t.toString()})).every((function(t){return h.toString().includes(t)}))||(s.props.points=a.concat(h))}else s.props=n;else r.pList.set(o,e)}},p.prototype._convertBrushDataAndRenderToBoard=function(t){var e=this._painter.width/t.width,i=this._convertBrushDataToCurrentBoardSize(t),n=i.shape,r=i.props,s=i.position,a=i.pId,h=i.style;i.width,i.height;var l=new V[n](a,{props:r,position:s,style:o(o({},h),{lineWidth:h.lineWidth*e})});this._painter.addElement(l)},p.prototype._renderCurrentPainter=function(){var t=this,e=this._fileBoardData.get(this._boardId);e&&(this._boardId=e.bId,this._painter.id=this._boardId,this._painter.setCanvasBGColor(e.color),this._painter.setCanvasBGImage(e.image),this._painter.scalePainter(e.scale),this._painter.reset(),this._painter.canUndoList=e.canUndoList,this._painter.canRedoList=e.canRedoList,e.pList.forEach((function(e){t._convertBrushDataAndRenderToBoard(e)})))},p.prototype._convertBrushDataToCurrentPainter=function(){},p.prototype._authGateWay=function(){var e,i,o,h;return n(this,void 0,void 0,(function(){var n,l,c,p,u,_,f,y,g,S,T,C,m,b,A,I,D,N,R,B,x,O,w,L,P,M,W,U,G=this;return r(this,(function(r){switch(r.label){case 0:return n=new $,this._authState!==t.BoardConnectionState.RECONNECTING&&(this._authState=t.BoardConnectionState.CONNECTING,this.emit(d.CONNECTION_STATE_CHANGE,this._authState,"")),l=new URL(v.GATEWAY_ADDRESS),[4,q(n.joinGateway({appId:this._appid,uid:this.uid,cname:this._channel,cType:0,wss:"https:"===l.protocol}))];case 1:if(c=a.apply(void 0,[r.sent(),2]),p=c[0],u=c[1],p)return[2,Promise.reject(p)];if(_=u.code,f=u.accessToken,y=u.addresses,g=u.boardAddr,S=u.sessionid,0!==_)return[3,19];if(this._createBoardChannelInstance(),this._createRTMChannelInstance(),!(g.length>0&&y.length>0))return[3,18];T=!1,r.label=2;case 2:r.trys.push([2,7,8,9]),C=s(g),m=C.next(),r.label=3;case 3:return m.done?[3,6]:(R=m.value,B=R.addr,x=R.port,O=R.wss,[4,q(this._connectBoardServer(O,B,x,f))]);case 4:if(b=a.apply(void 0,[r.sent(),2]),!b[0])return T=!0,[3,6];r.label=5;case 5:return m=C.next(),[3,3];case 6:return[3,9];case 7:return A=r.sent(),P={error:A},[3,9];case 8:try{m&&!m.done&&(M=C.return)&&M.call(C)}finally{if(P)throw P.error}return[7];case 9:if(!T)return k.info("...."),this._authState=t.BoardConnectionState.RECONNECTING,null===(e=this._boardSignal)||void 0===e||e.disconnectServer(),null===(i=this._rtmSignal)||void 0===i||i.disconnectServer(),this._boardSignal=void 0,this._rtmSignal=void 0,setTimeout((function(){G.emit(d.CONNECTION_STATE_CHANGE,G._authState,"BOARD_SERVER_ERROR"),G._authGateWay()}),6e3),[2,Promise.reject(new Y(E.GATEWAY_SERVER_ERROR,"connect bNode failed"))];I=!1,r.label=10;case 10:r.trys.push([10,15,16,17]),D=s(y),N=D.next(),r.label=11;case 11:return N.done?[3,14]:(R=N.value,B=R.addr,x=R.port,O=R.wss,[4,q(this._connectRTMServer(O,B,x,S,f))]);case 12:if(w=a.apply(void 0,[r.sent(),2]),!w[0])return I=!0,[3,14];r.label=13;case 13:return N=D.next(),[3,11];case 14:return[3,17];case 15:return L=r.sent(),W={error:L},[3,17];case 16:try{N&&!N.done&&(U=D.return)&&U.call(D)}finally{if(W)throw W.error}return[7];case 17:return I?(this._authState=t.BoardConnectionState.CONNECTED,this.emit(d.CONNECTION_STATE_CHANGE,this._authState,""),k.info("connect gate way success."),k.info("begin get channel info..."),this._boardSignal.doGetChannelInfo(),[3,19]):(k.info("...."),this._authState=t.BoardConnectionState.RECONNECTING,null===(o=this._boardSignal)||void 0===o||o.disconnectServer(),null===(h=this._rtmSignal)||void 0===h||h.disconnectServer(),this._boardSignal=void 0,this._rtmSignal=void 0,setTimeout((function(){G.emit(d.CONNECTION_STATE_CHANGE,G._authState,"RTM_SERVER_ERROR"),G._authGateWay()}),6e3),[2,Promise.reject(new Y(E.GATEWAY_SERVER_ERROR,"connect mNode failed"))]);case 18:return[2,Promise.reject(new Y(E.CAN_NOT_GET_GATEWAY_SERVER))];case 19:return[2]}}))}))},p.prototype._connectRTMServer=function(t,e,i,o,s){return n(this,void 0,void 0,(function(){var a=this;return r(this,(function(h){switch(h.label){case 0:return this._rtmSignal.configServer(t,e,i),[4,this._rtmSignal.connectServer().then((function(){return n(a,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return t={UserId:this.uid,UserSId:"",AcsToken:s,SdkVer:"",SessionId:o},[4,this._rtmSignal.doOnline(t)];case 1:return[2,e.sent()]}}))}))})).then((function(){return n(a,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this._rtmSignal.doJoinChannel(this._channel)];case 1:return[2,t.sent()]}}))}))}))];case 1:return[2,h.sent()]}}))}))},p.prototype._connectBoardServer=function(e,i,o,s){var a;return n(this,void 0,void 0,(function(){return r(this,(function(n){return null===(a=this._boardSignal)||void 0===a||a.configServer(e,i,o),this._authState===t.BoardConnectionState.CONNECTING||this._authState===t.BoardConnectionState.RECONNECTING?[2,this._boardSignal.connectServer(this._channel,this.uid,s)]:[2]}))}))},p.prototype._createBoardChannelInstance=function(){var e=this;!this._boardSignal&&(this._boardSignal=new Z),this._boardSignal.init({appId:this._appid}),this._boardSignal.handleMediaServerEvents=function(i,o){var n,r;if("connection-state-change"===i){var s=o.curState,a=o.reason;o.revState,"RECONNECTING"===s&&(k.debug("reconnect board server... "),e._authState!==t.BoardConnectionState.RECONNECTING&&(e._authState=t.BoardConnectionState.RECONNECTING,null===(n=e._boardSignal)||void 0===n||n.disconnectServer(),null===(r=e._rtmSignal)||void 0===r||r.disconnectServer(),e._boardSignal=void 0,e._rtmSignal=void 0,setTimeout((function(){e.emit(d.CONNECTION_STATE_CHANGE,e._authState,a),e._authGateWay()}),6e3)))}}},p.prototype._createRTMChannelInstance=function(){!this._rtmSignal&&(this._rtmSignal=new J),this._rtmSignal.init({appId:this._appid}),this._rtmSignal.handleMediaServerEvents=this._handleRTMMessage.bind(this)},p.prototype._handleRTMMessage=function(e,i){var o,n,r,s,a=this;if("connection-state-change"===e){var h=i.curState,p=i.reason;i.revState,k.debug("rtm connection-state-change ",h),"RECONNECTING"===h&&(k.debug("reconnect real time message server... "),this._authState!==t.BoardConnectionState.RECONNECTING&&(this._authState=t.BoardConnectionState.RECONNECTING,null===(o=this._boardSignal)||void 0===o||o.disconnectServer(),null===(n=this._rtmSignal)||void 0===n||n.disconnectServer(),this._boardSignal=void 0,this._rtmSignal=void 0,setTimeout((function(){a.emit(d.CONNECTION_STATE_CHANGE,a._authState,p),a._authGateWay()}),6e3)))}else if("RecvMsgFromPeer"===e){i.ChanId;var u=i.FromUId,_=i.MsgBody;i.MsgId,i.MsgType;var f=(y=JSON.parse(_)).cmd,v=y.data;if(f===c.CHAN_DATA)this._processChannelInfo(v),this._painter.id=this._boardId,this._painter.uid=this.uid;else if(f===c.CUR_BOARD_DATA){k.info("get current board data.");var E=y.isFinished;this._processBoardData(y),this._renderCurrentPainter(),E&&(this._painter.hideLoading(),this._painter.setEnable(!0),this.emit(d.DATA_SYNC_COMPLETED))}else f===c.CACHE_BOARD_DATA&&(k.info("get cache board data."),this._processBoardData(y))}else if("RecvMsgFromChan"===e){i.ChanId;u=i.FromUId,_=i.MsgBody;i.MsgId,i.MsgType;var y;f=(y=JSON.parse(_)).cmd;y.bId;v=y.data;if(u===this.uid)return;if(f===c.ADD_SHAPE){var g=v.bId,S=v.pId,T=v.shape,C=v.props;if(v.style,v.width,v.height,v.offset,k.debug("remote user add shape ("+T+" - "+S+")"),B=this._fileBoardData.get(g)){var m=B.pList.get(S);if(m)if(T===l.FREE_DRAW){var b=m.props.points,A=C.points;b.map((function(t){return t.toString()})).every((function(t){return A.toString().includes(t)}))||(m.props.points=b.concat(A))}else m.props=C;else B.pList.set(S,v);g===this._boardId&&(this._painter.clear(),B.pList.forEach((function(t){a._convertBrushDataAndRenderToBoard(t)})))}}else if(f===c.DELETE_SHAPE){var I=v.bId,D=v.pIds;k.debug("remote user delete shapes: "+D);var N=this._fileBoardData.get(I);if(N){var R=I===this._boardId;R&&(this._painter.clearLaserPoint(),this._painter.clear()),N.pList.forEach((function(t){var e=t.pId;~D.indexOf(e)?N.pList.delete(e):R&&a._convertBrushDataAndRenderToBoard(t)}))}}else if(f===c.MOVE_SHAPE){var B,x=v.bId,O=v.pIds,w=v.offset;k.debug("remote user move shapes: "+O+", offset: "+w),(B=this._fileBoardData.get(x))&&(this._painter.clearLaserPoint(),this._painter.clear(),B.pList.forEach((function(t){if(~O.indexOf(t.pId)){var e=t.width,i=t.height,o=[w[0]*e,w[1]*i];t.shape===l.LASER_POINTER?t.position=o:(t.position[0]+=o[0],t.position[1]+=o[1])}x===a._boardId&&a._convertBrushDataAndRenderToBoard(t)})))}else if(f===c.ADD_BOARD){var L=v.bId;k.debug("remote user add board: "+L),this._addBoard(L)}else if(f===c.DELETE_BOARD){var P=v.bIds;k.debug("remote user delete board: "+P),this._deleteBoard(P)}else if(f===c.SWITCH_BOARD){var M=v.bId;k.debug("remote user switch to board: "+M),this._gotoBoard(M)}else if(f===c.SCALE_BOARD){var W=v,U=W.bId,G=W.scale;k.debug("remote user scale board to "+G),this._scaleBoard(U,G),this.emit(d.SCALE_BOARD,U,G)}else if(f===c.CLEAR_BOARD){var H=v,F=H.bId,K=H.bg;k.debug("remote user clear board brush true, clear background "+K);var V=this._fileBoardData.get(F);V&&(V.pList.clear(),V.canUndoList=[],V.canRedoList=[],this._painter.clearAll(),K&&(this._setBoardBGColor(F,"#ffffff"),this._setBoardBGImage(F,"")),this.emit(d.CLEAR_BOARD,this._fileId,this._boardId),this.emit(d.CAN_REDO_STATUS_CHANGE,(null===(r=this._painter)||void 0===r?void 0:r.canRedoList.length)>0),this.emit(d.CAN_UNDO_STATUS_CHANGE,(null===(s=this._painter)||void 0===s?void 0:s.canUndoList.length)>0))}else if(f===c.RESET_BOARD)k.debug("remote user rest board"),this._resetBoard(),this.emit(d.RESET_BOARD,this._fileId,this._boardId);else if(f===c.UPDATE_BACKGROUND){var Y=v.bId,z=v.color;k.debug("remote user update background color "+z),this._setBoardBGColor(Y,z),this.emit(d.BOARD_BACKGROUND_COLOR_CHANGE,this._fileId,this._boardId,z)}else if(f===c.UPDATE_BACKGROUND_IMAGE){var j=v.bId,X=v.image;k.debug("remote user update background image "+X),this._setBoardBGImage(j,X)}else c.UPDATE_BACKGROUND_H5}},p.prototype._getFileInfo=function(t){var e=this._fileList.get(t);return e||null},p.prototype._addBoard=function(t){var e,i;this._curMaxBoardPage+=1;var o=new et;o.bId=t,o.color=this._initConfig.styleParams.globalBackgroundColor,this._fileBoardData.set(t,o);var n=this._fileList.get(this._fileId);n.boardList.push(t),this._currentBoardPage=n.boardList.length,this._totalBoardCount=n.boardList.length,this._boardId=t,k.info(""+this._currentBoardPage+""),this._renderCurrentPainter(),this.emit(d.ADD_BOARD,this._fileId,[t]),this.emit(d.GOTO_BOARD,this._fileId,this._boardId),this.emit(d.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(d.CAN_UNDO_STATUS_CHANGE,(null===(i=this._painter)||void 0===i?void 0:i.canUndoList.length)>0)},p.prototype._deleteBoard=function(t){for(var e,i,o=this._getFileInfo(this._fileId),n=o.boardList.length-1;n>-1;n--){var r=o.boardList[n];t.includes(r)&&(this._fileBoardData.delete(r),o.boardList.splice(n,1),r===this._boardId&&(this._currentBoardPage-=1,this._totalBoardCount=o.boardList.length,k.info(""+this._currentBoardPage+""),this._boardId=o.boardList[this._currentBoardPage-1],this._renderCurrentPainter(),this.emit(d.GOTO_BOARD,this._fileId,this._boardId),this.emit(d.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(d.CAN_UNDO_STATUS_CHANGE,(null===(i=this._painter)||void 0===i?void 0:i.canUndoList.length)>0)))}this.emit(d.DELETE_BOARD,this._fileId,[t])},p.prototype._gotoBoard=function(t){var e,i,o=this._getFileInfo(this._fileId),n=o.boardList.indexOf(t);this._currentBoardPage=n+1,this._totalBoardCount=o.boardList.length,this._boardId=t,k.info(""+this._currentBoardPage+",  "+this._totalBoardCount),this._renderCurrentPainter(),this.emit(d.GOTO_BOARD,this._fileId,this._boardId),this.emit(d.CAN_REDO_STATUS_CHANGE,(null===(e=this._painter)||void 0===e?void 0:e.canRedoList.length)>0),this.emit(d.CAN_UNDO_STATUS_CHANGE,(null===(i=this._painter)||void 0===i?void 0:i.canUndoList.length)>0)},p.prototype._resetBoard=function(){k.info("board reset success."),this._painter.clearAll();var t=this._getFileInfo(this._fileId);this._fileList.clear();var e=t.boardList[0],i=new et;i.bId=e,this._boardId=e,this._fileId="#DEFAULT",t.fId=this._fileId,t.boardList=[e],this._fileBoardData.clear(),this._fileBoardData.set(e,i),this._fileList.set(this._fileId,t),this._currentBoardPage=1,this._totalBoardCount=1,this._curMaxBoardPage=1,this._boardId=e,this._renderCurrentPainter()},p.prototype._scaleBoard=function(t,e){var i=this,o=this._fileBoardData.get(t);o&&(o.scale=e),t===this._boardId&&(k.info(""+e),this._painter.scalePainter(e),this._painter.clear(!0),this._painter.canUndoList=o.canUndoList,this._painter.canRedoList=o.canRedoList,o&&o.pList.forEach((function(t){i._convertBrushDataAndRenderToBoard(t)})),this._painter.renderControlBox())},p.prototype._setBoardBGColor=function(t,e){var i,o=this._fileBoardData.get(t);o&&(o.color=e),t===this._boardId&&(null===(i=this._painter)||void 0===i||i.setCanvasBGColor(e),k.info(""+e))},p.prototype._setGlobalBoardBGColor=function(t){var e=this,i=this._getFileInfo(this._fileId);i&&(this._initConfig.styleParams.globalBackgroundColor=t,i.boardList.forEach((function(i){var o,n=e._fileBoardData.get(i);n.color=t,n.bId===e._boardId&&(null===(o=e._painter)||void 0===o||o.setCanvasBGColor(t))})))},p.prototype._setBoardBGImage=function(t,e){var i=this._fileBoardData.get(t);i&&(i.image=e),t===this._boardId&&(this._painter.setCanvasBGImage(e),k.info(""+e))},p.prototype._setBoardH5=function(t,e){var i=this._fileBoardData.get(t);i&&(i.url=e),t===this._boardId&&k.info(""+e)},p}(U);return t.ArWhiteBoard=it,t.ErrorCode=E,t.NetworkErrorCode=y,t.createBoard=function(t){return new it(t)},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
